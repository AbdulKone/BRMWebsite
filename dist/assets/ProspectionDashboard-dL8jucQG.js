var Qe=Object.defineProperty;var Ze=(a,t,s)=>t in a?Qe(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var Ae=(a,t,s)=>Ze(a,typeof t!="symbol"?t+"":t,s);import{c as M,i as K,b as W,j as e,X as se,s as N,C as Ie,f as de,a as me,P as ke,k as U,T as Ce,l as Ke,U as ve,M as Xe,S as Ye,g as et}from"./index-DN8h3Y9b.js";import{r as o,R as Pe}from"./react-vendor-VkFUI6JC.js";import{P as Oe,S as He}from"./save-CY1Hemzt.js";import{T as ze,A as Ee}from"./trash-2-BwtB9nAO.js";import{a as tt,b as st,C as Te}from"./clock-DYNXt7Fe.js";import{U as we}from"./user-CCxstMVk.js";import{M as re}from"./mail-0jcSGkfv.js";import{A as at}from"./alert-circle-BoGZEYs9.js";import{ProspectApiService as De}from"./prospectApiService-DuRKMtOj.js";import"./ui-vendor-jY-liuQK.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=M("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=M("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=M("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=M("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=M("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=M("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=M("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=M("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=M("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=M("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=M("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=M("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=M("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=M("MousePointer",[["path",{d:"m3 3 7.07 16.97 2.51-7.39 7.39-2.51L3 3z",key:"y2ucgo"}],["path",{d:"m13 13 6 6",key:"1nhxnf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=M("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=M("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=M("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=M("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=M("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=M("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=M("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=M("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=M("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=M("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=M("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=M("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Me={new:{label:"Nouveau",color:"bg-blue-500"},contacted:{label:"Contacté",color:"bg-yellow-500"},interested:{label:"Intéressé",color:"bg-green-500"},qualified:{label:"Qualifié",color:"bg-purple-500"},proposal_sent:{label:"Proposition envoyée",color:"bg-orange-500"},negotiation:{label:"Négociation",color:"bg-red-500"},closed_won:{label:"Gagné",color:"bg-emerald-500"},closed_lost:{label:"Perdu",color:"bg-gray-500"}},jt=({onViewDetails:a,onEditProspect:t,onAddProspect:s})=>{const{prospects:r,loading:l,deleteProspect:c}=K(),{handleError:i,handleSuccess:n}=W(),[m,f]=o.useState(""),[b,C]=o.useState("all"),[h,j]=o.useState(1),E=10,v=o.useCallback(async(x,w)=>{if(window.confirm(`Êtes-vous sûr de vouloir supprimer ${w} ?`))try{await c(x),n(`${w} supprimé avec succès`);const d=Math.ceil((r.length-1)/E);h>d&&d>0&&j(d)}catch(d){i(d instanceof Error?d.message:"Erreur lors de la suppression du prospect")}},[c,r.length,E,h,i,n]),g=o.useMemo(()=>r.filter(x=>{const w=m.toLowerCase(),d=`${x.first_name||""} ${x.last_name||""}`.trim(),_=!m||x.company_name.toLowerCase().includes(w)||d.toLowerCase().includes(w)||x.email.toLowerCase().includes(w),D=b==="all"||x.status===b;return _&&D}),[r,m,b]),y=Math.ceil(g.length/E),S=o.useMemo(()=>{const x=(h-1)*E;return g.slice(x,x+E)},[g,h,E]),T=o.useCallback(x=>{f(x),j(1)},[]),q=o.useCallback(x=>{C(x),j(1)},[]),P=o.useCallback(x=>Me[x]||{label:x,color:"bg-gray-500"},[]);return l?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Gestion des Prospects"}),e.jsx("p",{className:"text-gray-400",children:"Gérez et suivez vos prospects efficacement"})]}),e.jsxs("button",{onClick:s,className:"flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 shadow-lg hover:shadow-xl",children:[e.jsx(Oe,{className:"w-5 h-5"}),e.jsx("span",{children:"Nouveau Prospect"})]})]}),e.jsx("div",{className:"bg-gray-800/50 border border-gray-700/50 rounded-xl p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Rechercher par nom, email ou entreprise...",value:m,onChange:x=>T(x.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-700/50 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(lt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsxs("select",{value:b,onChange:x=>q(x.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-700/50 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none transition-all duration-200",children:[e.jsx("option",{value:"all",children:"Tous les statuts"}),Object.entries(Me).map(([x,w])=>e.jsx("option",{value:x,children:w.label},x))]})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-4 text-sm",children:[e.jsxs("span",{className:"text-gray-400",children:["Total: ",e.jsx("span",{className:"text-white font-semibold",children:g.length})]}),e.jsxs("span",{className:"text-gray-400",children:["Page: ",e.jsxs("span",{className:"text-white font-semibold",children:[h,"/",y]})]})]})]})}),e.jsx("div",{className:"grid gap-3 sm:gap-4",children:S.length===0?e.jsx("div",{className:"text-center py-8 sm:py-12 text-gray-400",children:e.jsx("p",{className:"text-sm sm:text-base",children:m||b!=="all"?"Aucun prospect ne correspond aux critères de recherche.":"Aucun prospect trouvé. Commencez par en ajouter un !"})}):S.map(x=>{const w=`${x.first_name||""} ${x.last_name||""}`.trim(),d=P(x.status);return e.jsx("div",{className:"bg-gray-800 p-3 sm:p-4 rounded-lg border border-gray-700 hover:border-gray-600 transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold truncate",children:x.company_name}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium text-white ${d.color}`,children:d.label})]}),e.jsxs("div",{className:"space-y-1",children:[w&&e.jsx("p",{className:"text-gray-300 text-sm sm:text-base",children:w}),e.jsx("p",{className:"text-gray-400 text-sm",children:x.email}),x.position&&e.jsx("p",{className:"text-gray-500 text-sm",children:x.position})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>a==null?void 0:a(x.id),className:"p-2 text-blue-400 hover:text-blue-300 hover:bg-blue-900/20 rounded-lg transition-colors",title:"Voir les détails",children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>t==null?void 0:t(x.id),className:"p-2 text-green-400 hover:text-green-300 hover:bg-green-900/20 rounded-lg transition-colors",title:"Modifier",children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>v(x.id,x.company_name),className:"p-2 text-red-400 hover:text-red-300 hover:bg-red-900/20 rounded-lg transition-colors",title:"Supprimer",children:e.jsx(ze,{className:"w-4 h-4"})})]})]})},x.id)})}),y>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["Affichage de ",(h-1)*E+1," à ",Math.min(h*E,g.length)," sur ",g.length," prospects"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>j(Math.max(1,h-1)),disabled:h===1,className:"p-2 rounded-lg border border-gray-600 text-gray-400 hover:text-white hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(tt,{className:"w-4 h-4"})}),e.jsxs("span",{className:"px-3 py-1 text-sm text-gray-300",children:["Page ",h," sur ",y]}),e.jsx("button",{onClick:()=>j(Math.min(y,h+1)),disabled:h===y,className:"p-2 rounded-lg border border-gray-600 text-gray-400 hover:text-white hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(st,{className:"w-4 h-4"})})]})]})]})},vt=({prospectId:a,onClose:t})=>{const{saveProspect:s,prospects:r}=K(),{handleError:l,handleSuccess:c}=W(),[i,n]=o.useState({company_name:"",first_name:"",last_name:"",email:"",position:"",website:"",linkedin_url:"",notes:"",source:"",tags:[]}),[m,f]=o.useState({}),[b,C]=o.useState(!1);o.useEffect(()=>{if(a){const g=r.find(y=>y.id===a);g&&n({company_name:g.company_name,first_name:g.first_name||"",last_name:g.last_name||"",email:g.email,position:g.position||"",website:g.website||"",linkedin_url:g.linkedin_url||"",notes:g.notes||"",source:g.source||"",tags:g.tags||[]})}},[a,r]);const h=o.useCallback(()=>{const g={};i.company_name.trim()?i.company_name.trim().length<2&&(g.company_name="Le nom de l'entreprise doit contenir au moins 2 caractères"):g.company_name="Le nom de l'entreprise est requis",i.first_name.trim()?i.first_name.trim().length<2&&(g.first_name="Le prénom doit contenir au moins 2 caractères"):g.first_name="Le prénom est requis",i.last_name.trim()?i.last_name.trim().length<2&&(g.last_name="Le nom de famille doit contenir au moins 2 caractères"):g.last_name="Le nom de famille est requis";const y=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return i.email.trim()?y.test(i.email.trim())||(g.email="Format d'email invalide"):g.email="L'email est requis",i.website.trim()&&!/^https?:\/\/.+\..+/.test(i.website.trim())&&(g.website="Format d'URL invalide (doit commencer par http:// ou https://)"),i.linkedin_url.trim()&&!/^https:\/\/(www\.)?linkedin\.com\/(in|company)\/.+/.test(i.linkedin_url.trim())&&(g.linkedin_url="Format d'URL LinkedIn invalide"),a||r.find(T=>T.email.toLowerCase()===i.email.trim().toLowerCase())&&(g.email="Un prospect avec cet email existe déjà"),f(g),Object.keys(g).length===0},[i,r,a]),j=o.useCallback((g,y)=>{n(S=>({...S,[g]:y})),f(S=>{if(S[g]){const T={...S};return delete T[g],T}return S})},[]),E=o.useCallback(async g=>{if(g.preventDefault(),!!h()){C(!0),f({});try{const y={company_name:i.company_name.trim(),first_name:i.first_name.trim(),last_name:i.last_name.trim(),email:i.email.trim().toLowerCase(),position:i.position.trim(),website:i.website.trim(),linkedin_url:i.linkedin_url.trim(),notes:i.notes.trim(),source:i.source.trim(),tags:i.tags,last_contact_date:new Date().toISOString(),segment_targeting:["corporate"],lead_score:0,conversion_probability:0,enriched_data:{}};a?(await s({id:a,...y}),c("Prospect modifié avec succès")):(await s(y),c("Prospect ajouté avec succès")),t()}catch(y){l("Erreur lors de la sauvegarde du prospect",y instanceof Error?y.message:"Erreur inconnue"),f({general:"Erreur lors de la sauvegarde du prospect"})}finally{C(!1)}}},[i,h,a,s,t,l,c]),v=o.useCallback(()=>{b||t()},[b,t]);return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-black to-gray-900",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 sm:py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl",children:e.jsx(we,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent",children:a?"Modifier le prospect":"Nouveau prospect"}),e.jsx("p",{className:"text-gray-400 text-sm sm:text-base mt-1",children:a?"Mettez à jour les informations du prospect":"Ajoutez un nouveau prospect à votre pipeline"})]})]}),e.jsx("button",{onClick:v,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition-all duration-200",disabled:b,children:e.jsx(se,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700/50 rounded-2xl p-6 sm:p-8",children:[m.general&&e.jsx("div",{className:"mb-6 p-4 bg-red-500/20 border border-red-500/30 rounded-xl",children:e.jsx("p",{className:"text-red-400",children:m.general})}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center space-x-2",children:[e.jsx(We,{className:"w-5 h-5 text-blue-400"}),e.jsx("span",{children:"Informations de l'entreprise"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Nom de l'entreprise *"}),e.jsx("input",{type:"text",value:i.company_name,onChange:g=>j("company_name",g.target.value),className:`w-full px-4 py-3 bg-gray-700/50 border rounded-xl text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${m.company_name?"border-red-500":"border-gray-600/50"}`,placeholder:"Nom de l'entreprise",disabled:b,required:!0}),m.company_name&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:m.company_name})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Site web"}),e.jsxs("div",{className:"relative",children:[e.jsx(ot,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"url",value:i.website,onChange:g=>j("website",g.target.value),className:`w-full pl-10 pr-4 py-3 bg-gray-700/50 border rounded-xl text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${m.website?"border-red-500":"border-gray-600/50"}`,placeholder:"https://exemple.com",disabled:b})]}),m.website&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:m.website})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Source"}),e.jsxs("div",{className:"relative",children:[e.jsx(pt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",value:i.source,onChange:g=>j("source",g.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-700/50 border border-gray-600/50 rounded-xl text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"Source du prospect",disabled:b})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center space-x-2",children:[e.jsx(we,{className:"w-5 h-5 text-green-400"}),e.jsx("span",{children:"Informations du contact"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Prénom *"}),e.jsx("input",{type:"text",value:i.first_name,onChange:g=>j("first_name",g.target.value),className:`w-full px-4 py-3 bg-gray-700/50 border rounded-xl text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${m.first_name?"border-red-500":"border-gray-600/50"}`,placeholder:"Prénom",disabled:b,required:!0}),m.first_name&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:m.first_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Nom *"}),e.jsx("input",{type:"text",value:i.last_name,onChange:g=>j("last_name",g.target.value),className:`w-full px-4 py-3 bg-gray-700/50 border rounded-xl text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${m.last_name?"border-red-500":"border-gray-600/50"}`,placeholder:"Nom de famille",disabled:b,required:!0}),m.last_name&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:m.last_name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Email *"}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"email",value:i.email,onChange:g=>j("email",g.target.value),className:`w-full pl-10 pr-4 py-3 bg-gray-700/50 border rounded-xl text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${m.email?"border-red-500":"border-gray-600/50"}`,placeholder:"email@exemple.com",disabled:b,required:!0})]}),m.email&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:m.email})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Poste"}),e.jsx("input",{type:"text",value:i.position,onChange:g=>j("position",g.target.value),className:`w-full px-4 py-3 bg-gray-700/50 border rounded-xl text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${m.position?"border-red-500":"border-gray-600/50"}`,placeholder:"Poste occupé",disabled:b}),m.position&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:m.position})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"LinkedIn"}),e.jsxs("div",{className:"relative",children:[e.jsx(dt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"url",value:i.linkedin_url,onChange:g=>j("linkedin_url",g.target.value),className:`w-full pl-10 pr-4 py-3 bg-gray-700/50 border rounded-xl text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${m.linkedin_url?"border-red-500":"border-gray-600/50"}`,placeholder:"https://linkedin.com/in/profil",disabled:b})]}),m.linkedin_url&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:m.linkedin_url})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center space-x-2",children:[e.jsx(Z,{className:"w-5 h-5 text-purple-400"}),e.jsx("span",{children:"Notes"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Notes sur le prospect"}),e.jsx("textarea",{value:i.notes,onChange:g=>j("notes",g.target.value),className:"w-full px-4 py-3 bg-gray-700/50 border border-gray-600/50 rounded-xl text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 resize-none",rows:4,placeholder:"Notes, commentaires, informations importantes...",disabled:b})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-4 pt-6 border-t border-gray-700/50",children:[e.jsx("button",{type:"button",onClick:v,className:"px-6 py-3 bg-gray-700/50 hover:bg-gray-600/50 text-gray-300 rounded-xl font-medium transition-all duration-200 disabled:opacity-50",disabled:b,children:"Annuler"}),e.jsx("button",{type:"submit",className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-xl font-medium transition-all duration-200 disabled:opacity-50 shadow-lg hover:shadow-xl",disabled:b,children:b?"Sauvegarde...":a?"Mettre à jour":"Créer le prospect"})]})]})]})]})})},Se=[{id:"new_prospect_sequence",name:"Séquence Nouveau Prospect - Projets Visuels",description:"Séquence d'introduction pour nouveaux prospects dans l'audiovisuel",targetSegment:["advertising","music","luxury","sports"],isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),steps:[{id:"step_1",templateId:"visual_intro_advertising",delayDays:0,condition:"always",priority:"high"},{id:"step_2",templateId:"portfolio_presentation_demo",delayDays:3,condition:"no_response",priority:"medium"},{id:"step_3",templateId:"advanced_follow_up_sequence_1",delayDays:7,condition:"no_response",priority:"medium"},{id:"step_4",templateId:"advanced_follow_up_sequence_2",delayDays:14,condition:"no_response",priority:"low"}]},{id:"interested_prospect_sequence",name:"Séquence Prospect Intéressé",description:"Séquence pour prospects ayant montré de l'intérêt",targetSegment:["advertising","music","luxury","sports"],isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),steps:[{id:"step_1",templateId:"detailed_commercial_proposal",delayDays:0,condition:"always",priority:"high"},{id:"step_2",templateId:"advanced_follow_up_sequence_1",delayDays:5,condition:"no_response",priority:"high"},{id:"step_3",templateId:"portfolio_presentation_demo",delayDays:10,condition:"no_response",priority:"medium"}]}],wt=async(a,t)=>{const s=Se.find(i=>i.id===t);if(!s)throw new Error("Séquence introuvable");const r=new Date,l=s.steps.map(i=>({prospectId:a,sequenceId:t,stepId:i.id,templateId:i.templateId,scheduledFor:new Date(r.getTime()+i.delayDays*24*60*60*1e3).toISOString(),status:"pending",createdAt:r.toISOString()})),{error:c}=await N.from("scheduled_emails").insert(l);if(c)throw c},Nt=async(a,t)=>{await N.from("scheduled_emails").update({status:"cancelled"}).eq("prospectId",a).eq("sequenceId",t).eq("status","pending")},qe={new:{color:"bg-blue-500",label:"Nouveau"},contacted:{color:"bg-yellow-500",label:"Contacté"},interested:{color:"bg-green-500",label:"Intéressé"},qualified:{color:"bg-emerald-500",label:"Qualifié"},proposal_sent:{color:"bg-purple-500",label:"Proposition envoyée"},negotiation:{color:"bg-orange-500",label:"En négociation"},closed_won:{color:"bg-green-600",label:"Gagné"},closed_lost:{color:"bg-red-500",label:"Perdu"},nurturing:{color:"bg-indigo-500",label:"En nurturing"}},_t={sent:"text-blue-400",delivered:"text-green-400",opened:"text-purple-400",clicked:"text-yellow-400",bounced:"text-red-400",complained:"text-red-600"},St=({prospectId:a,onClose:t,onEdit:s})=>{const{prospects:r,saveProspect:l,calculateDetailedLeadScore:c,enrichProspectData:i}=K(),{handleError:n}=W(),[m,f]=o.useState([]),[b,C]=o.useState(null),[h,j]=o.useState([]),[E,v]=o.useState(!0),[g,y]=o.useState(""),[S,T]=o.useState(!1),[q,P]=o.useState(""),[x,w]=o.useState(!1),d=r.find(p=>p.id===a),_=o.useCallback(p=>p.first_name&&p.last_name?`${p.first_name} ${p.last_name}`:p.contact_name||"Contact non défini",[]),D=o.useCallback(p=>qe[p]||{color:"bg-gray-500",label:p},[]),I=o.useCallback(p=>_t[p]||"text-gray-400",[]),O=o.useCallback(p=>p>=80?"text-green-400":p>=60?"text-yellow-400":p>=40?"text-orange-400":"text-red-400",[]),V=o.useCallback(p=>p>=70?"text-red-400":p>=40?"text-yellow-400":"text-green-400",[]),R=o.useCallback(async()=>{try{const{data:p,error:A}=await N.from("email_tracking").select("*").eq("prospect_id",a).order("sent_at",{ascending:!1});if(A)throw A;f(p||[])}catch(p){n("Erreur lors du chargement de l'historique des emails",p instanceof Error?p.message:"Erreur inconnue")}finally{v(!1)}},[a,n]),z=o.useCallback(async p=>{const A=p.length,u=p.filter(be=>be.opened_at).length,k=p.filter(be=>be.responded_at).length,$=A>0?k/A*100:0,ie=A>0?u/A*100:0,le=d!=null&&d.last_contact_date?new Date(d.last_contact_date):new Date,oe=Math.floor((Date.now()-le.getTime())/(1e3*60*60*24)),pe=await c(a),Je=typeof pe=="number"?pe:pe.total;let Y=0;Y+={interested:40,contacted:20,qualified:60,proposal_sent:70,negotiation:80}[d==null?void 0:d.status]||0,$>50&&(Y+=30),ie>70&&(Y+=20),oe<7&&(Y+=10);let ce=0;return oe>60?ce+=70:oe>30&&(ce+=40),$===0&&A>2&&(ce+=30),{leadScore:Je,conversionProbability:Math.min(Y,100),daysSinceLastContact:oe,emailsSent:A,emailsOpened:u,responseRate:$,churnRisk:Math.min(ce,100)}},[d,a,c]),H=o.useCallback(async()=>{try{const p=await N.from("email_tracking").select("*").eq("prospect_id",a);if(p.data){const A=await z(p.data);C(A)}}catch(p){n("Erreur lors du calcul des métriques",p instanceof Error?p.message:"Erreur inconnue")}},[a,z,n]),F=o.useCallback(async()=>{try{const{data:p,error:A}=await N.from("scheduled_emails").select("sequence_id").eq("prospect_id",a).eq("status","pending");if(A)throw A;const u=[...new Set((p==null?void 0:p.map(k=>k.sequence_id))||[])];j(u)}catch(p){n("Erreur lors du chargement des séquences actives",p instanceof Error?p.message:"Erreur inconnue")}},[a,n]),G=o.useCallback(async()=>{if(d&&!d.enriched_data)try{await i(a)}catch(p){n("Erreur lors de l'enrichissement du prospect",p instanceof Error?p.message:"Erreur inconnue")}},[d,a,i,n]),J=o.useCallback(async p=>{try{await l({id:a,status:p,last_contact_date:new Date().toISOString()}),H()}catch(A){n("Erreur lors de la mise à jour du statut",A instanceof Error?A.message:"Erreur inconnue")}},[a,l,H,n]),X=o.useCallback(async()=>{if(g.trim()){T(!0);try{const p=(d==null?void 0:d.notes)||"",A=new Date().toLocaleString("fr-FR"),u=p?`${p}

[${A}] ${g}`:`[${A}] ${g}`;await l({id:a,notes:u,last_contact_date:new Date().toISOString()}),y(""),H()}catch(p){console.error("Erreur lors de l'ajout de la note:",p)}finally{T(!1)}}},[g,d==null?void 0:d.notes,a,l,H]),L=o.useCallback(async()=>{if(q){w(!0);try{await wt(a,q),await F(),P("")}catch(p){console.error("Erreur lors du démarrage de la séquence:",p)}finally{w(!1)}}},[q,a,F]),B=o.useCallback(async p=>{try{await Nt(a,p),await F()}catch(A){console.error("Erreur lors de l'arrêt de la séquence:",A)}},[a,F]),ge=o.useMemo(()=>Se.filter(p=>!h.includes(p.id)),[h]),ne=o.useMemo(()=>D((d==null?void 0:d.status)||"new"),[d==null?void 0:d.status,D]);return o.useEffect(()=>{a&&Promise.all([R(),H(),F(),G()])},[a,R,H,F,G]),d?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-900 p-6 rounded-lg w-full max-w-6xl max-h-[90vh] overflow-y-auto text-white",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:d.company_name}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium text-white ${ne.color}`,children:ne.label}),b&&b.churnRisk>70&&e.jsxs("span",{className:"px-2 py-1 bg-red-600 text-white text-xs rounded-full flex items-center space-x-1",children:[e.jsx(Ee,{className:"w-3 h-3"}),e.jsx("span",{children:"Risque élevé"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:s,className:"px-3 py-1 bg-blue-600 hover:bg-blue-500 rounded text-sm transition-colors text-white",children:"Modifier"}),e.jsx("button",{onClick:t,className:"p-2 rounded hover:bg-gray-700 transition-colors text-white",children:e.jsx(se,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-white",children:"Informations"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(We,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:"text-gray-200",children:d.company_name})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(we,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:"text-gray-200",children:_(d)})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(re,{className:"w-5 h-5 text-gray-400"}),e.jsx("a",{href:`mailto:${d.email}`,className:"text-blue-400 hover:underline",children:d.email})]}),d.phone&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ht,{className:"w-5 h-5 text-gray-400"}),e.jsx("a",{href:`tel:${d.phone}`,className:"text-blue-400 hover:underline",children:d.phone})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ie,{className:"w-5 h-5 text-gray-400"}),e.jsxs("span",{className:"text-gray-200",children:["Dernier contact: ",d.last_contact_date?de(new Date(d.last_contact_date),"PPP à HH:mm",{locale:me}):"Aucun contact enregistré"]})]})]}),b&&e.jsxs("div",{className:"bg-gray-800 p-4 rounded border border-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(Fe,{className:"w-5 h-5 text-gray-400"}),e.jsx("h4",{className:"font-semibold text-white",children:"Métriques"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Score Lead:"}),e.jsxs("span",{className:`ml-2 font-medium ${O(b.leadScore)}`,children:[b.leadScore,"/100"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Conversion:"}),e.jsxs("span",{className:`ml-2 font-medium ${O(b.conversionProbability)}`,children:[b.conversionProbability,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Emails envoyés:"}),e.jsx("span",{className:"ml-2 font-medium text-blue-400",children:b.emailsSent})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Taux réponse:"}),e.jsxs("span",{className:`ml-2 font-medium ${O(b.responseRate)}`,children:[b.responseRate.toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Risque churn:"}),e.jsxs("span",{className:`ml-2 font-medium ${V(b.churnRisk)}`,children:[b.churnRisk,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Jours silence:"}),e.jsx("span",{className:`ml-2 font-medium ${b.daysSinceLastContact>30?"text-red-400":b.daysSinceLastContact>14?"text-yellow-400":"text-green-400"}`,children:b.daysSinceLastContact})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-white",children:"Statut"}),e.jsx("select",{value:d.status,onChange:p=>J(p.target.value),className:"w-full p-2 rounded bg-gray-800 border border-gray-700 focus:border-blue-500 focus:outline-none text-white",children:Object.entries(qe).map(([p,A])=>e.jsx("option",{value:p,children:A.label},p))})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{className:"w-5 h-5 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Séquences d'emails"})]}),h.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-green-400",children:"Séquences actives"}),h.map(p=>{const A=Se.find(u=>u.id===p);return e.jsxs("div",{className:"bg-green-900/20 border border-green-700 p-3 rounded",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:(A==null?void 0:A.name)||p}),e.jsx("button",{onClick:()=>B(p),className:"p-1 text-red-400 hover:text-red-300 transition-colors",title:"Arrêter la séquence",children:e.jsx(gt,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:A==null?void 0:A.description})]},p)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-white",children:"Démarrer une séquence"}),e.jsxs("select",{value:q,onChange:p=>P(p.target.value),className:"w-full p-2 rounded bg-gray-800 border border-gray-700 focus:border-blue-500 focus:outline-none text-sm text-white",children:[e.jsx("option",{value:"",children:"Sélectionner une séquence..."}),ge.map(p=>e.jsx("option",{value:p.id,children:p.name},p.id))]}),e.jsxs("button",{onClick:L,disabled:!q||x,className:"w-full px-3 py-2 bg-blue-600 hover:bg-blue-500 rounded text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2 text-white",children:[e.jsx(ke,{className:"w-4 h-4"}),e.jsx("span",{children:x?"Démarrage...":"Démarrer la séquence"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ct,{className:"w-5 h-5 text-gray-400"}),e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Historique des emails (",m.length,")"]})]}),E?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"})}):m.length===0?e.jsx("p",{className:"text-gray-400 text-sm py-4",children:"Aucun email envoyé pour le moment."}):e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:m.map(p=>e.jsxs("div",{className:"bg-gray-800 p-3 rounded border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-sm text-white",children:p.subject}),e.jsxs("div",{className:"flex items-center space-x-2",children:[p.sequence_id&&e.jsx("span",{className:"text-xs bg-blue-600 text-white px-2 py-1 rounded",children:"Séquence"}),e.jsx("span",{className:`text-xs font-medium ${I(p.status)}`,children:p.status})]})]}),e.jsx("p",{className:"text-xs text-gray-400",children:de(new Date(p.sent_at),"PPP à HH:mm",{locale:me})}),p.opened_at&&e.jsxs("p",{className:"text-xs text-purple-400 mt-1",children:["Ouvert le ",de(new Date(p.opened_at),"PPP à HH:mm",{locale:me})]}),p.responded_at&&e.jsxs("p",{className:"text-xs text-green-400 mt-1",children:["Répondu le ",de(new Date(p.responded_at),"PPP à HH:mm",{locale:me})]})]},p.id))})]})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(mt,{className:"w-5 h-5 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Notes"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{value:g,onChange:p=>y(p.target.value),placeholder:"Ajouter une note...",className:"w-full p-3 rounded bg-gray-800 border border-gray-700 focus:border-blue-500 focus:outline-none text-white resize-none",rows:3}),e.jsx("button",{onClick:X,disabled:!g.trim()||S,className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-white",children:S?"Ajout...":"Ajouter la note"})]}),d.notes&&e.jsx("div",{className:"bg-gray-800 p-4 rounded border border-gray-700",children:e.jsx("pre",{className:"text-sm text-gray-200 whitespace-pre-wrap font-sans",children:d.notes})})]})]})}):null},te=a=>`${a.first_name||""} ${a.last_name||""}`.trim()||a.company_name,kt=a=>a?a.includes("@")&&a.includes("."):!1,Be=(a,t)=>{let s=a.subject,r=a.content;return Object.entries(t).forEach(([l,c])=>{const i=new RegExp(`{{${l}}}`,"g");s=s.replace(i,c),r=r.replace(i,c)}),{subject:s,content:r}},Ct=a=>`${window.location.origin}/unsubscribe?id=${a}`,Ge=a=>({contact_name:te(a),sender_name:"Black Road Music",company_name:a.company_name||"",project_name:"Votre Projet",unsubscribe_link:Ct(a.id)});class Et{static async sendEmail({to:t,subject:s,body:r,templateId:l,prospectId:c,campaignId:i}){return await U.withErrorHandling(async()=>{const n=await fetch("/api/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:t,subject:s,body:r,templateId:l,prospectId:c,campaignId:i})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const m=await n.json();return m.success&&(await this.saveEmailTracking({prospectId:c,templateId:l,campaignId:i,subject:s,messageId:m.messageId}),await this.updateProspectStatus(c)),m},"Erreur lors de l'envoi de l'email")||{success:!1,error:"Erreur inconnue"}}static async saveEmailTracking({prospectId:t,templateId:s,campaignId:r,subject:l,messageId:c}){await N.from("email_tracking").insert({prospect_id:t,template_id:s,campaign_id:r,email_status:"sent",sent_at:new Date().toISOString(),subject:l,message_id:c})}static async updateProspectStatus(t){await N.from("prospects").update({last_email_sent:new Date().toISOString(),status:"contacted"}).eq("id",t)}}const Tt=()=>{const[a,t]=o.useState([]),[s,r]=o.useState(!0),l=async()=>{const i=await U.withErrorHandling(async()=>{const{data:n,error:m}=await N.from("email_templates").select("*").eq("is_active",!0).order("priority",{ascending:!1}).order("name");if(m)throw m;return(n||[]).map(f=>({...f,is_active:!!f.is_active}))},"Erreur lors du chargement des templates");i&&t(i),r(!1)};return o.useEffect(()=>{l()},[]),{templates:a,loading:s,getTemplate:i=>a.find(n=>n.template_key===i&&n.is_active)}},At=()=>{const[a,t]=o.useState(!1),[s,r]=o.useState({success:0,failed:0}),{handleSuccess:l,handleError:c}=W.getState(),i=async(m,f,b)=>{if(!kt(m.email))return c(new Error("Email invalide"),`Email invalide pour ${te(m)}`),!1;const C=Ge(m),h=Be(f,C),j=await Et.sendEmail({to:m.email,subject:h.subject,body:h.content,templateId:f.template_key,prospectId:m.id,campaignId:b});return j.success?(l(`Email envoyé avec succès à ${te(m)}`),!0):(c(new Error(j.error||"Erreur inconnue"),`Échec envoi email pour ${te(m)}`),!1)};return{sending:a,sendResults:s,sendBulkEmails:async(m,f)=>{t(!0),r({success:0,failed:0});const b=`campaign_${Date.now()}`;for(const C of m){const h=await i(C,f,b);r(j=>({success:j.success+(h?1:0),failed:j.failed+(h?0:1)}))}t(!1)}}},Pt=()=>{const{prospects:a}=K(),{templates:t,loading:s,getTemplate:r}=Tt(),{sending:l,sendResults:c,sendBulkEmails:i}=At(),[n,m]=o.useState(""),[f,b]=o.useState([]),[C,h]=o.useState(null),j=a.filter(y=>y.status==="new"||y.status==="contacted"||y.status==="interested"),E=()=>{const y=r(n);if(!y)return;const S=a.find(P=>P.id===f[0]);if(!S)return;const T=Ge(S),q=Be(y,T);h(q)},v=async()=>{const y=r(n);if(!y)return;const S=a.filter(T=>f.includes(T.id));await i(S,y)},g=y=>{b(S=>S.includes(y)?S.filter(T=>T!==y):[...S,y])};return s?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Campagne Email"}),e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"text-gray-500",children:"Chargement des templates..."})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Campagne Email"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Sélectionner un template (",t.length," disponibles)"]}),e.jsxs("select",{value:n,onChange:y=>m(y.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Choisir un template..."}),t.map(y=>e.jsxs("option",{value:y.template_key,children:[y.name," (",y.category,")"]},y.template_key))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Sélectionner les prospects (",f.length," sélectionnés)"]}),e.jsx("div",{className:"max-h-60 overflow-y-auto border border-gray-300 rounded-lg",children:j.map(y=>e.jsxs("label",{className:"flex items-center p-3 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f.includes(y.id),onChange:()=>g(y.id),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:te(y)}),e.jsx("div",{className:"text-sm text-gray-500",children:y.email}),e.jsx("div",{className:"text-xs text-gray-400",children:y.company_name})]})]},y.id))})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:E,disabled:!n||f.length===0,className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Aperçu"}),e.jsx("button",{onClick:v,disabled:!n||f.length===0||l,className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:l?"Envoi en cours...":`Envoyer (${f.length})`})]}),(c.success>0||c.failed>0)&&e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Résultats de l'envoi :"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"text-green-600",children:["✓ ",c.success," emails envoyés avec succès"]}),c.failed>0&&e.jsxs("div",{className:"text-red-600",children:["✗ ",c.failed," emails en échec"]})]})]}),C&&e.jsxs("div",{className:"border border-gray-300 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Aperçu de l'email :"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Sujet :"})," ",C.subject]}),e.jsx("div",{className:"whitespace-pre-wrap text-sm text-black",children:C.content})]})]})]})},Dt=()=>{const{handleError:a}=W(),[t,s]=o.useState(null),[r,l]=o.useState([]),[c,i]=o.useState(!0),[n,m]=o.useState("30"),f=o.useCallback(async()=>{try{const h=new Date;h.setDate(h.getDate()-parseInt(n));const{data:j,error:E}=await N.from("email_tracking").select("email_status").gte("sent_at",h.toISOString());if(E)throw E;if(!j||j.length===0){s({total_sent:0,total_delivered:0,total_opened:0,total_clicked:0,total_bounced:0,total_complained:0,delivery_rate:0,open_rate:0,click_rate:0,bounce_rate:0});return}const v=j.reduce((x,w)=>(x[w.email_status]=(x[w.email_status]||0)+1,x),{}),g=j.length,y=v.delivered||0,S=v.opened||0,T=v.clicked||0,q=v.bounced||0,P=v.complained||0;s({total_sent:g,total_delivered:y,total_opened:S,total_clicked:T,total_bounced:q,total_complained:P,delivery_rate:g>0?y/g*100:0,open_rate:y>0?S/y*100:0,click_rate:S>0?T/S*100:0,bounce_rate:g>0?q/g*100:0})}catch(h){a("Erreur lors du chargement des statistiques",h instanceof Error?h.message:"Erreur inconnue")}},[n,a]),b=o.useCallback(async()=>{try{const{data:h,error:j}=await N.from("email_tracking").select(`
          id,
          subject,
          email_status,
          sent_at,
          prospects!inner(
            company_name
          )
        `).order("sent_at",{ascending:!1}).limit(10);if(j)throw j;if(!h||h.length===0){l([]);return}const E=h.map(v=>{var g,y;return{id:v.id,subject:v.subject||"Sans objet",status:v.email_status,sent_at:v.sent_at,prospect_company:((y=(g=v.prospects)==null?void 0:g[0])==null?void 0:y.company_name)||"Entreprise inconnue"}});l(E)}catch(h){a("Erreur lors du chargement des emails récents",h instanceof Error?h.message:"Erreur inconnue")}},[a]);o.useEffect(()=>{(async()=>{i(!0);try{await Promise.all([f(),b()])}catch(j){a("Erreur lors du chargement des données",j instanceof Error?j.message:"Erreur inconnue")}finally{i(!1)}})()},[f,b,a]);const C=o.useCallback(h=>{switch(h){case"sent":return"text-blue-400";case"delivered":return"text-green-400";case"opened":return"text-purple-400";case"clicked":return"text-yellow-400";case"bounced":return"text-red-400";case"complained":return"text-red-600";default:return"text-gray-400"}},[]);return c?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Statistiques Email"}),e.jsxs("select",{value:n,onChange:h=>m(h.target.value),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:border-blue-500 focus:outline-none",children:[e.jsx("option",{value:"7",children:"7 derniers jours"}),e.jsx("option",{value:"30",children:"30 derniers jours"}),e.jsx("option",{value:"90",children:"90 derniers jours"}),e.jsx("option",{value:"365",children:"Année complète"})]})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-gray-700 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(re,{className:"w-8 h-8 text-blue-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:t.total_sent}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Emails envoyés"})]})]})}),e.jsx("div",{className:"bg-gray-700 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ce,{className:"w-8 h-8 text-green-400"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[t.delivery_rate.toFixed(1),"%"]}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Taux de livraison"})]})]})}),e.jsx("div",{className:"bg-gray-700 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(he,{className:"w-8 h-8 text-purple-400"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[t.open_rate.toFixed(1),"%"]}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Taux d'ouverture"})]})]})}),e.jsx("div",{className:"bg-gray-700 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ut,{className:"w-8 h-8 text-yellow-400"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[t.click_rate.toFixed(1),"%"]}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Taux de clic"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Détails des envois"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Livrés:"}),e.jsx("span",{className:"text-green-400",children:t.total_delivered})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Ouverts:"}),e.jsx("span",{className:"text-purple-400",children:t.total_opened})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Cliqués:"}),e.jsx("span",{className:"text-yellow-400",children:t.total_clicked})]})]})]}),e.jsxs("div",{className:"bg-gray-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Problèmes"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Rebonds:"}),e.jsx("span",{className:"text-red-400",children:t.total_bounced})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Plaintes:"}),e.jsx("span",{className:"text-red-600",children:t.total_complained})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Taux de rebond:"}),e.jsxs("span",{className:"text-red-400",children:[t.bounce_rate.toFixed(1),"%"]})]})]})]})]}),(t.bounce_rate>5||t.delivery_rate<95)&&e.jsxs("div",{className:"bg-yellow-900 border border-yellow-700 text-yellow-100 px-4 py-3 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ee,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Attention"})]}),e.jsxs("div",{className:"mt-2 text-sm",children:[t.bounce_rate>5&&e.jsxs("p",{children:["• Taux de rebond élevé (",t.bounce_rate.toFixed(1),"%) - Vérifiez la qualité de vos listes"]}),t.delivery_rate<95&&e.jsxs("p",{children:["• Taux de livraison faible (",t.delivery_rate.toFixed(1),"%) - Vérifiez votre réputation d'expéditeur"]})]})]})]}),e.jsxs("div",{className:"bg-gray-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Emails récents"}),r.length===0?e.jsx("p",{className:"text-gray-400 text-sm",children:"Aucun email récent"}):e.jsx("div",{className:"space-y-2",children:r.map(h=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-800 rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium truncate",children:h.subject}),e.jsx("p",{className:"text-sm text-gray-400",children:h.prospect_company})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:`text-sm font-medium ${C(h.status)}`,children:h.status}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(h.sent_at).toLocaleDateString("fr-FR")})]})]},h.id))})]})]})},$e=({activeTab:a,onTabChange:t,editingTemplateId:s,onCloseForm:r})=>{const{handleError:l,handleWarning:c}=W(),[i,n]=o.useState("list"),[m,f]=o.useState(null),b=a||i,C=s||m,h=o.useCallback(u=>{t?t("form"):(f(u),n("form"))},[t]),j=o.useCallback(()=>{t?t("form"):(f(null),n("form"))},[t]),E=o.useCallback(()=>{r?r():(f(null),n("list"))},[r]),[v,g]=o.useState([]),[y,S]=o.useState(!0),[T,q]=o.useState(!1),[P,x]=o.useState(null),[w,d]=o.useState(!1),[_,D]=o.useState({name:"",subject:"",content:"",category:"prospection",priority:"medium",variables:{},segment_targeting:{},template_key:"",ab_test_variant:"A"}),I=o.useCallback(async()=>{try{S(!0);const{data:u,error:k}=await N.from("email_templates").select("*").order("created_at",{ascending:!1});if(k)throw k;g(u||[])}catch(u){l(u,"Erreur lors du chargement des templates")}finally{S(!1)}},[l]);o.useEffect(()=>{I()},[I]),o.useEffect(()=>{if(C&&b==="form"){const u=v.find(k=>k.id===C);u&&D({id:u.id,name:u.name,subject:u.subject,content:u.content,category:u.category,priority:u.priority,variables:u.variables||{},segment_targeting:u.segment_targeting||{},template_key:u.template_key,ab_test_variant:u.ab_test_variant||"A"})}else!C&&b==="form"&&D({name:"",subject:"",content:"",category:"prospection",priority:"medium",variables:{},segment_targeting:{},template_key:"",ab_test_variant:"A"})},[C,v,b]);const O=o.useCallback(u=>{const k=/\{\{([^}]+)\}\}/g,$={};let ie;for(;(ie=k.exec(u))!==null;){const le=ie[1].trim();$[le]||($[le]="")}return $},[]),V=o.useCallback(u=>{const k=O(u);D($=>({...$,variables:{...$.variables,...k}}))},[O]);o.useEffect(()=>{_.content&&V(_.content)},[_.content,V]);const R=o.useCallback((u,k)=>{D($=>({...$,variables:{...$.variables,[u]:k}}))},[]),z=o.useMemo(()=>[{value:"prospection",label:"Prospection"},{value:"follow_up",label:"Relance"},{value:"closing",label:"Closing"},{value:"nurturing",label:"Nurturing"}],[]),H=o.useMemo(()=>[{value:"high",label:"Haute"},{value:"medium",label:"Moyenne"},{value:"low",label:"Basse"}],[]),F=o.useCallback(u=>{const k=u.target.value;D($=>({...$,name:k,template_key:k.toLowerCase().replace(/[^a-z0-9]/g,"_")}))},[]),G=o.useCallback(u=>{D(k=>({...k,subject:u.target.value}))},[]),J=o.useCallback(u=>{D(k=>({...k,content:u.target.value}))},[]),X=o.useCallback(u=>{D(k=>({...k,category:u.target.value}))},[]),L=o.useCallback(u=>{D(k=>({...k,priority:u.target.value}))},[]),B=o.useCallback(async()=>{if(!_.name.trim()||!_.subject.trim()||!_.content.trim()){c("Veuillez remplir tous les champs obligatoires");return}try{q(!0);const u={name:_.name.trim(),subject:_.subject.trim(),content:_.content.trim(),category:_.category,priority:_.priority,variables:_.variables,segment_targeting:_.segment_targeting,template_key:_.template_key,ab_test_variant:_.ab_test_variant,is_active:!0,performance_metrics:{}};if(C){const{error:k}=await N.from("email_templates").update(u).eq("id",C);if(k)throw k;l("Template mis à jour avec succès")}else{const{error:k}=await N.from("email_templates").insert([u]);if(k)throw k;l("Template créé avec succès")}await I(),E()}catch(u){l("Erreur lors de la sauvegarde du template",u instanceof Error?u.message:"Erreur inconnue")}finally{q(!1)}},[_,C,I,E,l]),ge=o.useCallback(async(u,k)=>{if(confirm(`Êtes-vous sûr de vouloir supprimer le template "${k}" ?`))try{const{error:$}=await N.from("email_templates").delete().eq("id",u);if($)throw $;await I(),l(`Template "${k}" supprimé avec succès`)}catch($){l("Erreur lors de la suppression du template",$ instanceof Error?$.message:"Erreur inconnue")}},[I,l]),ne=o.useCallback(async u=>{try{const k={name:`${u.name} (Copie)`,subject:u.subject,content:u.content,category:u.category,priority:u.priority,variables:u.variables,segment_targeting:u.segment_targeting,template_key:`${u.template_key}_copy_${Date.now()}`,ab_test_variant:u.ab_test_variant,is_active:!0,performance_metrics:{}},{error:$}=await N.from("email_templates").insert([k]);if($)throw $;await I(),l("Template dupliqué avec succès")}catch(k){l("Erreur lors de la duplication du template",k instanceof Error?k.message:"Erreur inconnue")}},[I,l]),p=o.useCallback(u=>{x(u),d(!0)},[]),A=o.useMemo(()=>v,[v]);return y?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-400"}),e.jsx("div",{className:"text-gray-300",children:"Chargement des templates..."})]})}):b==="list"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-2 flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg",children:e.jsx(Z,{className:"w-6 h-6 text-white"})}),e.jsx("span",{children:"Gestion des Templates"})]}),e.jsx("p",{className:"text-gray-400",children:"Créez et gérez vos templates d'emails de prospection"})]}),e.jsxs("button",{onClick:j,className:"flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 shadow-lg hover:shadow-xl",children:[e.jsx(Oe,{className:"w-5 h-5"}),e.jsx("span",{children:"Nouveau Template"})]})]}),e.jsxs("div",{className:"grid gap-4",children:[A.map(u=>e.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700/50 rounded-xl p-6 hover:border-gray-600/50 transition-all duration-200",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:u.name}),e.jsx("p",{className:"text-gray-300 mb-3",children:u.subject}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-600/20 text-blue-300 border border-blue-500/30",children:u.category}),e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border ${u.priority==="high"?"bg-red-600/20 text-red-300 border-red-500/30":u.priority==="medium"?"bg-yellow-600/20 text-yellow-300 border-yellow-500/30":"bg-green-600/20 text-green-300 border-green-500/30"}`,children:["Priorité ",u.priority==="high"?"Haute":u.priority==="medium"?"Moyenne":"Basse"]}),e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-purple-600/20 text-purple-300 border border-purple-500/30",children:["Variant ",u.ab_test_variant]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx("button",{onClick:()=>p(u),className:"p-2 text-blue-400 hover:text-blue-300 hover:bg-blue-900/20 rounded-lg transition-all duration-200",title:"Aperçu",children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>h(u.id),className:"p-2 text-green-400 hover:text-green-300 hover:bg-green-900/20 rounded-lg transition-all duration-200",title:"Modifier",children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ne(u),className:"p-2 text-yellow-400 hover:text-yellow-300 hover:bg-yellow-900/20 rounded-lg transition-all duration-200",title:"Dupliquer",children:e.jsx(nt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ge(u.id,u.name),className:"p-2 text-red-400 hover:text-red-300 hover:bg-red-900/20 rounded-lg transition-all duration-200",title:"Supprimer",children:e.jsx(ze,{className:"w-4 h-4"})})]})]})},u.id)),A.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-400 bg-gray-800/30 rounded-xl border border-gray-700/50",children:[e.jsx(Z,{className:"w-12 h-12 text-gray-500 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Aucun template trouvé"}),e.jsx("p",{className:"text-sm",children:"Créez votre premier template pour commencer."})]})]}),w&&P&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-gray-800/95 backdrop-blur-sm border border-gray-700/50 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Aperçu du Template"}),e.jsx("button",{onClick:()=>d(!1),className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg transition-all duration-200",children:e.jsx(se,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-300 mb-2",children:"Nom:"}),e.jsx("p",{className:"text-white bg-gray-700/50 p-3 rounded-lg",children:P.name})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-300 mb-2",children:"Catégorie:"}),e.jsx("p",{className:"text-white bg-gray-700/50 p-3 rounded-lg",children:P.category})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-300 mb-2",children:"Sujet:"}),e.jsx("p",{className:"text-white bg-gray-700/50 p-3 rounded-lg",children:P.subject})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-300 mb-2",children:"Contenu:"}),e.jsx("div",{className:"bg-gray-700/50 p-4 rounded-lg text-white whitespace-pre-wrap max-h-64 overflow-y-auto",children:P.content})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-300 mb-2",children:"Priorité:"}),e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${P.priority==="high"?"bg-red-600/20 text-red-300 border border-red-500/30":P.priority==="medium"?"bg-yellow-600/20 text-yellow-300 border border-yellow-500/30":"bg-green-600/20 text-green-300 border border-green-500/30"}`,children:P.priority==="high"?"Haute":P.priority==="medium"?"Moyenne":"Basse"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-300 mb-2",children:"Variant A/B:"}),e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-purple-600/20 text-purple-300 border border-purple-500/30",children:["Variant ",P.ab_test_variant]})]})]}),Object.keys(P.variables).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-300 mb-3",children:"Variables:"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(P.variables).map(([u,k])=>e.jsxs("div",{className:"bg-gray-700/50 p-3 rounded-lg",children:[e.jsxs("span",{className:"text-blue-300 font-medium",children:[u,":"]}),e.jsx("span",{className:"text-gray-300 ml-2",children:k||"(vide)"})]},u))})]})]})]})})})]}):b==="form"?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl",children:e.jsx(Z,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:C?"Modifier le template":"Nouveau template"}),e.jsx("p",{className:"text-gray-400",children:C?"Mettez à jour les informations du template":"Créez un nouveau template pour vos campagnes"})]})]}),e.jsx("button",{onClick:E,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition-all duration-200",disabled:T,children:e.jsx(se,{className:"w-6 h-6"})})]})}),e.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700/50 rounded-2xl p-6 sm:p-8",children:e.jsxs("form",{onSubmit:u=>{u.preventDefault(),B()},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center space-x-2",children:[e.jsx(Z,{className:"w-5 h-5 text-blue-400"}),e.jsx("span",{children:"Informations générales"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Nom du template *"}),e.jsx("input",{type:"text",value:_.name,onChange:F,className:"w-full px-4 py-3 bg-gray-700/50 border border-gray-600/50 rounded-xl text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"Nom du template",disabled:T,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Sujet de l'email *"}),e.jsx("input",{type:"text",value:_.subject,onChange:G,className:"w-full px-4 py-3 bg-gray-700/50 border border-gray-600/50 rounded-xl text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"Sujet de votre email",disabled:T,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Catégorie"}),e.jsx("select",{value:_.category,onChange:X,className:"w-full px-4 py-3 bg-gray-700/50 border border-gray-600/50 rounded-xl text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",disabled:T,children:z.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Priorité"}),e.jsx("select",{value:_.priority,onChange:L,className:"w-full px-4 py-3 bg-gray-700/50 border border-gray-600/50 rounded-xl text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",disabled:T,children:H.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Variant A/B"}),e.jsxs("select",{value:_.ab_test_variant||"A",onChange:u=>D(k=>({...k,ab_test_variant:u.target.value})),className:"w-full px-4 py-3 bg-gray-700/50 border border-gray-600/50 rounded-xl text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",disabled:T,children:[e.jsx("option",{value:"A",children:"Variant A"}),e.jsx("option",{value:"B",children:"Variant B"}),e.jsx("option",{value:"C",children:"Variant C"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center space-x-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-green-400"}),e.jsx("span",{children:"Contenu du template"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Contenu de l'email *"}),e.jsx("textarea",{value:_.content,onChange:J,rows:8,className:"w-full px-4 py-3 bg-gray-700/50 border border-gray-600/50 rounded-xl text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 resize-none",placeholder:"Contenu de votre template email...",disabled:T,required:!0}),e.jsxs("p",{className:"text-sm text-gray-400 mt-2",children:["Utilisez ","{{variables}}"," pour insérer des variables dynamiques"]})]})]}),Object.keys(_.variables).length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center space-x-2",children:[e.jsx(at,{className:"w-5 h-5 text-purple-400"}),e.jsxs("span",{children:["Variables détectées (",Object.keys(_.variables).length,")"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.keys(_.variables).map(u=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:["Variable: ",u]}),e.jsx("input",{type:"text",value:_.variables[u],onChange:k=>R(u,k.target.value),className:"w-full px-4 py-3 bg-gray-700/50 border border-gray-600/50 rounded-xl text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:`Valeur par défaut pour ${u}`,disabled:T})]},u))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-4 pt-6 border-t border-gray-700/50",children:[e.jsx("button",{type:"button",onClick:E,className:"px-6 py-3 bg-gray-700/50 hover:bg-gray-600/50 text-gray-300 rounded-xl font-medium transition-all duration-200 disabled:opacity-50",disabled:T,children:"Annuler"}),e.jsx("button",{type:"submit",className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-xl font-medium transition-all duration-200 disabled:opacity-50 shadow-lg hover:shadow-xl flex items-center justify-center space-x-2",disabled:T||!_.name.trim()||!_.subject.trim()||!_.content.trim(),children:T?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Sauvegarde..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{children:C?"Mettre à jour":"Créer le template"})]})})]})]})})]}):null};class Mt{constructor(){Ae(this,"nowTs",()=>Math.floor(Date.now()/1e3))}async fetchWithTimeout(t,s={},r=1e4){const l=new AbortController,c=setTimeout(()=>l.abort(),r);try{const i=await fetch(t,{...s,signal:l.signal});return clearTimeout(c),i}catch(i){throw clearTimeout(c),i}}async generateSignature(t,s=5e3){const r=await this.fetchWithTimeout("/api/generate-signature",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},s);if(!r.ok){const c=await r.text().catch(()=>"");throw new Error(`Signature service failed: ${r.status} ${c}`)}const l=await r.json().catch(()=>null);if(!l||!l.signature)throw new Error("Invalid response from signature service");return l.signature}async triggerWorkflow(t,s={},r={timeoutMs:15e3}){const l={action:"trigger_workflow",data:{workflowId:t,...s},timestamp:this.nowTs()},c=await this.generateSignature(l,8e3),i=await this.fetchWithTimeout("/api/webhook-n8n",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...l,signature:c})},r.timeoutMs);if(!i.ok){const m=(i.headers.get("content-type")||"").includes("application/json")?JSON.stringify(await i.json().catch(()=>({}))):await i.text().catch(()=>"");throw new Error(`n8n trigger failed: ${i.status} ${m}`)}return await i.json().catch(()=>null)}async batchTriggerWorkflows(t,s={timeoutMs:3e4}){if(!Array.isArray(t)||t.length===0)throw new Error("Aucune action fournie pour batchTriggerWorkflows");const r={action:"batch_trigger",data:{items:t},timestamp:this.nowTs()},l=await this.generateSignature(r,8e3),c=await this.fetchWithTimeout("/api/webhook-n8n",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...r,signature:l})},s.timeoutMs);if(!c.ok){const n=(c.headers.get("content-type")||"").includes("application/json")?JSON.stringify(await c.json().catch(()=>({}))):await c.text().catch(()=>"");throw new Error(`Batch trigger failed: ${c.status} ${n}`)}return await c.json().catch(()=>null)}async toggleAutomation(t,s){const l={action:t?"start_automation":"stop_automation",data:{config:s},timestamp:this.nowTs()},c=await this.generateSignature(l,8e3),i=await this.fetchWithTimeout("/api/webhook-n8n",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...l,signature:c})},12e3);if(!i.ok){const n=await i.text().catch(()=>"");throw new Error(`n8n API error: ${i.status} ${n}`)}return await i.json().catch(()=>null)}async syncAutomationStatus(t){const s={action:"sync_automation_status",data:{config:t},timestamp:this.nowTs()},r=await this.generateSignature(s,8e3),l=await this.fetchWithTimeout("/api/webhook-n8n",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s,signature:r})},15e3);if(!l.ok){const c=await l.text().catch(()=>"");throw new Error(`Sync failed: ${l.status} ${c}`)}return await l.json().catch(()=>null)}async fetchStats(){const t=await this.fetchWithTimeout("/api/automation/stats",{},12e3);if(!t.ok){const s=await t.text().catch(()=>"");throw new Error(`Stats fetch failed: ${t.status} ${s}`)}return await t.json()}}const Q=new Mt;class qt{async getProspects(){const{data:t,error:s}=await N.from("prospects").select("*").order("created_at",{ascending:!1});if(s)throw new Error(`Erreur chargement prospects: ${s.message}`);return t||[]}async saveProspect(t){const s=new Date().toISOString(),r=t.id?{...t,updated_at:s}:{...t,created_at:s,updated_at:s},{data:l,error:c}=t.id?await N.from("prospects").update(r).eq("id",t.id).select().single():await N.from("prospects").insert([r]).select().single();if(c)throw new Error(`Erreur sauvegarde prospect: ${c.message}`);return l}async deleteProspect(t){const{error:s}=await N.from("prospects").delete().eq("id",t);if(s)throw new Error(`Erreur suppression prospect: ${s.message}`)}async updateProspectSegment(t,s){const{error:r}=await N.from("prospects").update({segment_targeting:[s]}).eq("id",t);if(r)throw new Error(`Erreur mise à jour segment: ${r.message}`)}async bulkUpdateProspectStatus(t,s){const{error:r}=await N.from("prospects").update({status:s,updated_at:new Date().toISOString()}).in("id",t);if(r)throw new Error(`Erreur mise à jour statut en masse: ${r.message}`)}async getProjects(){const{data:t,error:s}=await N.from("projects").select("*").order("display_order",{ascending:!0});if(s)throw new Error(`Erreur chargement projets: ${s.message}`);return t||[]}async saveProject(t){const{data:s,error:r}=t.id?await N.from("projects").update(t).eq("id",t.id).select().single():await N.from("projects").insert([t]).select().single();if(r)throw new Error(`Erreur sauvegarde projet: ${r.message}`);return s}async deleteProject(t){const{error:s}=await N.from("projects").delete().eq("id",t);if(s)throw new Error(`Erreur suppression projet: ${s.message}`)}async getArtists(){const{data:t,error:s}=await N.from("artists").select("*").order("display_order",{ascending:!0});if(s)throw new Error(`Erreur chargement artistes: ${s.message}`);return t||[]}async saveArtist(t){const{data:s,error:r}=t.id?await N.from("artists").update(t).eq("id",t.id).select().single():await N.from("artists").insert([t]).select().single();if(r)throw new Error(`Erreur sauvegarde artiste: ${r.message}`);return s}async deleteArtist(t){const{error:s}=await N.from("artists").delete().eq("id",t);if(s)throw new Error(`Erreur suppression artiste: ${s.message}`)}async getServices(){const{data:t,error:s}=await N.from("services").select("*").order("display_order",{ascending:!0});if(s)throw new Error(`Erreur chargement services: ${s.message}`);const{data:r,error:l}=await N.from("service_features").select("*");if(l)throw new Error(`Erreur chargement features: ${l.message}`);return(t||[]).map(c=>({...c,features:(r||[]).filter(i=>i.service_id===c.id).map(i=>i.feature)}))}async getProspectionMetrics(){const{data:t,error:s}=await N.from("prospects").select("status, created_at, lead_score, conversion_probability");if(s)throw new Error(`Erreur chargement métriques: ${s.message}`);const r=(t==null?void 0:t.length)||0,l=(t==null?void 0:t.filter(n=>n.lead_score&&n.lead_score>70).length)||0,c=new Date;c.setDate(1);const i=(t==null?void 0:t.filter(n=>new Date(n.created_at)>=c).length)||0;return{total_prospects:r,qualified_prospects:l,monthly_growth:i,conversion_rate:r>0?l/r*100:0}}async signIn(t,s){var i;const{data:{user:r},error:l}=await N.auth.signInWithPassword({email:t,password:s});if(l)throw l;if(!r)throw new Error("No user returned after sign in");const c=((i=r.app_metadata)==null?void 0:i.role)==="admin";if(!c)throw await N.auth.signOut(),new Error("Accès non autorisé. Seuls les administrateurs peuvent se connecter.");return{user:r,isAdmin:c}}async signOut(){const{error:t}=await N.auth.signOut();if(t)throw t}async getSession(){const{data:{session:t}}=await N.auth.getSession();return t}onAuthStateChange(t){return N.auth.onAuthStateChange(t)}async getAutomationConfig(){const{data:t,error:s}=await N.from("automation_config").select("*").eq("id","main").single();if(s&&s.code!=="PGRST116")throw new Error(`Erreur chargement config automation: ${s.message}`);return t}async saveAutomationConfig(t,s){const{data:r,error:l}=await N.from("automation_config").upsert({id:"main",is_active:t,config:s,updated_at:new Date().toISOString()}).select().single();if(l)throw new Error(`Erreur sauvegarde config automation: ${l.message}`);return r}}const ue=new qt,fe={isActive:!1,dailyLimit:50,followUpDelay:5,workingHours:{start:"09:00",end:"18:00"},workingDays:["monday","tuesday","wednesday","thursday","friday"],activityTimeoutMinutes:60,statsTimeframeDays:30,recentActivityHours:24,performanceThresholds:{openRate:{excellent:25,good:15},responseRate:{excellent:5,good:2}}},$t=Ke()((a,t)=>({isActive:!1,stats:null,config:fe,isLoading:!1,isInitialized:!1,initializeConfig:async()=>{t().isInitialized||(a({isLoading:!0}),await U.withErrorHandling(async()=>{const s=await ue.getAutomationConfig();if(s){const r={...fe,...s.config,isActive:!1};a({isActive:!1,config:r,isInitialized:!0});try{localStorage.setItem("automation_active",JSON.stringify(!1)),localStorage.setItem("automation_config",JSON.stringify(r))}catch(l){console.warn("Erreur localStorage:",l)}}else{let r=null;try{if(typeof window<"u"){const c=localStorage.getItem("automation_config");c&&(r=JSON.parse(c))}}catch(c){console.warn("Erreur lecture localStorage:",c)}const l={...fe,...r,isActive:!1};a({isActive:!1,config:l,isInitialized:!0});try{await ue.saveAutomationConfig(!1,l)}catch{W.getState().handleWarning("Impossible de sauvegarder la config initiale dans Supabase")}}},"Erreur lors de l'initialisation de la configuration"),a({isLoading:!1}))},updateConfig:async s=>{const l={...t().config,...s};a({config:l});try{localStorage.setItem("automation_config",JSON.stringify(l))}catch(c){console.warn("Erreur sauvegarde localStorage:",c)}await U.withErrorHandling(()=>ue.saveAutomationConfig(t().isActive,l),"Erreur sauvegarde config dans Supabase")},toggleAutomation:async()=>{a({isLoading:!0}),await U.withErrorHandling(async()=>{const r=!t().isActive,l=t().config,c={workflowId:"automation-main",isActive:r,settings:{dailyLimit:l.dailyLimit,followUpDelay:l.followUpDelay,workingHours:l.workingHours,workingDays:l.workingDays}};await Q.toggleAutomation(r,c),a({isActive:r});try{localStorage.setItem("automation_active",JSON.stringify(r))}catch(i){console.warn("Erreur sauvegarde localStorage:",i)}await ue.saveAutomationConfig(r,l),W.getState().handleSuccess(`Automation ${r?"activée":"désactivée"}`)},"Erreur lors du basculement de l'automation"),a({isLoading:!1})},triggerN8nWorkflow:async(s,r={},l={timeoutMs:15e3})=>{a({isLoading:!0});const c=await U.withErrorHandling(async()=>await Q.triggerWorkflow(s,r,{timeoutMs:l.timeoutMs||15e3}),"Erreur lors du déclenchement du workflow");return a({isLoading:!1}),c},batchTriggerWorkflows:async(s,r={timeoutMs:3e4})=>{a({isLoading:!0});const l=await U.withErrorHandling(async()=>await Q.batchTriggerWorkflows(s,{timeoutMs:r.timeoutMs||3e4}),"Erreur lors du déclenchement des workflows en lot");return a({isLoading:!1}),l},fetchStats:async()=>{a({isLoading:!0}),await U.withErrorHandling(async()=>{const s=await Q.fetchStats(),r={prospectsAdded:Number(s.prospectsAdded)||0,emailsSent:Number(s.emailsSent)||0,openRate:Number(s.openRate)||0,responseRate:Number(s.responseRate)||0,conversionRate:Number(s.conversionRate)||0,activeSequences:Number(s.activeSequences)||0,scheduledEmails:Number(s.scheduledEmails)||0,lastUpdate:new Date().toISOString(),prospectsAddedTrend:Number(s.prospectsAddedTrend)||0,emailsSentTrend:Number(s.emailsSentTrend)||0,openRateTrend:Number(s.openRateTrend)||0,responseRateTrend:Number(s.responseRateTrend)||0};a({stats:r})},"Erreur lors de la récupération des statistiques"),a({isLoading:!1})},syncWithN8n:async()=>{a({isLoading:!0});const s=await U.withErrorHandling(async()=>{var i;const r=t().config,l={workflowId:"automation-main",isActive:t().isActive,settings:{dailyLimit:r.dailyLimit,followUpDelay:r.followUpDelay,workingHours:r.workingHours,workingDays:r.workingDays}},c=await Q.syncAutomationStatus(l);if((i=c==null?void 0:c.data)!=null&&i.stats){const n=c.data.stats,m={prospectsAdded:Number(n.prospectsAdded)||0,emailsSent:Number(n.emailsSent)||0,openRate:Number(n.openRate)||0,responseRate:Number(n.responseRate)||0,conversionRate:Number(n.conversionRate)||0,activeSequences:Number(n.activeSequences)||0,scheduledEmails:Number(n.scheduledEmails)||0,lastUpdate:new Date().toISOString(),prospectsAddedTrend:Number(n.prospectsAddedTrend)||0,emailsSentTrend:Number(n.emailsSentTrend)||0,openRateTrend:Number(n.openRateTrend)||0,responseRateTrend:Number(n.responseRateTrend)||0};a({stats:m})}return c},"Erreur de synchronisation avec N8N");return a({isLoading:!1}),s},startProspectionCampaign:async()=>{a({isLoading:!0});const s=await U.withErrorHandling(async()=>{const r=t().config;return await Q.triggerWorkflow("prospect_enrichment",{campaignType:"prospection",config:{dailyLimit:r.dailyLimit,followUpDelay:r.followUpDelay,workingHours:r.workingHours,workingDays:r.workingDays}},{timeoutMs:3e4})},"Erreur lors du lancement de la campagne de prospection");return a({isLoading:!1}),s}}));class ee{static async fetchAutomationConfig(){return await U.withErrorHandling(async()=>{const{data:t,error:s}=await N.from("automation_config").select("*").eq("id","main").single();if(s&&s.code!=="PGRST116")throw s;if(t){const r=t.config;return{isActive:t.is_active,dailyLimit:r.dailyLimit||50,followUpDelay:r.followUpDelay||5,workingHours:r.workingHours||{start:"09:00",end:"18:00"},workingDays:r.workingDays||["monday","tuesday","wednesday","thursday","friday"],activityTimeoutMinutes:r.activityTimeoutMinutes||60,statsTimeframeDays:r.statsTimeframeDays||30,recentActivityHours:r.recentActivityHours||24,performanceThresholds:r.performanceThresholds||{openRate:{excellent:25,good:15},responseRate:{excellent:5,good:2}}}}return await this.createDefaultConfig()},"Erreur lors de la récupération de la configuration")}static async createDefaultConfig(){const t={isActive:!1,dailyLimit:50,followUpDelay:5,workingHours:{start:"09:00",end:"18:00"},workingDays:["monday","tuesday","wednesday","thursday","friday"],activityTimeoutMinutes:60,statsTimeframeDays:30,recentActivityHours:24,performanceThresholds:{openRate:{excellent:25,good:15},responseRate:{excellent:5,good:2}}};return await N.from("automation_config").insert({id:"main",is_active:!1,config:t}),t}static async updateConfig(t){try{await N.from("automation_config").upsert({id:"main",is_active:t.isActive,config:t,updated_at:new Date().toISOString()})}catch(s){throw console.error("Erreur lors de la mise à jour de la configuration:",s),s}}static async fetchAutomationStats(t){var s,r,l,c,i,n,m,f,b,C,h;try{const j=t.statsTimeframeDays,E=new Date(Date.now()-j*24*60*60*1e3).toISOString(),v=new Date(Date.now()-j*2*24*60*60*1e3).toISOString(),g=E,[y,S,T,q]=await Promise.all([N.from("prospects").select("id").gte("created_at",E),N.from("email_tracking").select("opened_at, responded_at, email_status").gte("sent_at",E),N.from("automated_sequences").select("id").eq("is_active",!0),N.from("prospects").select("id").not("next_follow_up","is",null).gte("next_follow_up",new Date().toISOString())]),[P,x]=await Promise.all([N.from("prospects").select("id").gte("created_at",v).lt("created_at",g),N.from("email_tracking").select("opened_at, responded_at, email_status").gte("sent_at",v).lt("sent_at",g)]),w=((s=S.data)==null?void 0:s.length)||0,d=((r=S.data)==null?void 0:r.filter(L=>L.opened_at).length)||0,_=((l=S.data)==null?void 0:l.filter(L=>L.responded_at).length)||0,D=((c=S.data)==null?void 0:c.filter(L=>L.email_status==="converted").length)||0,I=((i=y.data)==null?void 0:i.length)||0,O=((n=x.data)==null?void 0:n.length)||0,V=((m=x.data)==null?void 0:m.filter(L=>L.opened_at).length)||0,R=((f=x.data)==null?void 0:f.filter(L=>L.responded_at).length)||0,z=((b=P.data)==null?void 0:b.length)||0,H=(L,B)=>B===0?L>0?100:0:(L-B)/B*100,F=w>0?d/w*100:0,G=O>0?V/O*100:0,J=w>0?_/w*100:0,X=O>0?R/O*100:0;return{prospectsAdded:I,emailsSent:w,openRate:F,responseRate:J,conversionRate:w>0?D/w*100:0,activeSequences:((C=T.data)==null?void 0:C.length)||0,scheduledEmails:((h=q.data)==null?void 0:h.length)||0,lastUpdate:new Date().toISOString(),prospectsAddedTrend:H(I,z),emailsSentTrend:H(w,O),openRateTrend:H(F,G),responseRateTrend:H(J,X)}}catch(j){return console.error("Erreur lors de la récupération des stats:",j),null}}static async fetchRecentActivity(t){try{const s=[],r=t.recentActivityHours,l=new Date(Date.now()-r*60*60*1e3).toISOString(),{data:c}=await N.from("prospects").select("id, company_name, created_at").gte("created_at",l).order("created_at",{ascending:!1}).limit(5);c==null||c.forEach(n=>{s.push({id:`prospect-${n.id}`,type:"prospect_added",description:`Nouveau prospect ajouté: ${n.company_name}`,timestamp:n.created_at,status:"success"})});const{data:i}=await N.from("email_tracking").select(`
          id, 
          subject, 
          sent_at, 
          opened_at, 
          responded_at,
          prospects!inner(
            company_name
          )
        `).gte("sent_at",l).order("sent_at",{ascending:!1}).limit(10);return i==null||i.forEach(n=>{var f;const m=((f=n.prospects)==null?void 0:f.company_name)||"prospect";s.push({id:`email-sent-${n.id}`,type:"email_sent",description:`Email envoyé à ${m}: ${n.subject}`,timestamp:n.sent_at,status:"success"}),n.opened_at&&s.push({id:`email-opened-${n.id}`,type:"email_opened",description:`Email ouvert par ${m}`,timestamp:n.opened_at,status:"success"}),n.responded_at&&s.push({id:`email-replied-${n.id}`,type:"email_replied",description:`Réponse reçue de ${m}`,timestamp:n.responded_at,status:"success"})}),s.sort((n,m)=>new Date(m.timestamp).getTime()-new Date(n.timestamp).getTime()),s.slice(0,10)}catch(s){return console.error("Erreur lors de la récupération des activités:",s),[]}}static async checkSystemHealth(t,s,r){var l;try{const{error:c}=await N.from("automation_config").select("id").limit(1),i=!c;let n=!1;try{n=(await fetch("/api/webhook-n8n",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"health_check",timestamp:Math.floor(Date.now()/1e3)})})).ok}catch{n=!1}const{data:m}=await N.from("email_tracking").select("sent_at").order("sent_at",{ascending:!1}).limit(1),f=(l=m==null?void 0:m[0])!=null&&l.sent_at?new Date(m[0].sent_at):null;if(!i||!n)return{status:"disconnected",color:"red",label:"Déconnecté",lastActivity:f,n8nConnected:n,databaseConnected:i};if(r)return{status:"error",color:"red",label:"Erreur",lastActivity:f,n8nConnected:n,databaseConnected:i};if(!s)return{status:"paused",color:"yellow",label:"En pause",lastActivity:f,n8nConnected:n,databaseConnected:i};const b=((t==null?void 0:t.activityTimeoutMinutes)||60)*60*1e3;return f&&Date.now()-f.getTime()<b?{status:"active",color:"green",label:"Actif",lastActivity:f,n8nConnected:n,databaseConnected:i}:{status:"idle",color:"blue",label:"Inactif",lastActivity:f,n8nConnected:n,databaseConnected:i}}catch(c){return console.error("Erreur lors de la vérification de la santé du système:",c),{status:"error",color:"red",label:"Erreur de vérification",lastActivity:null,n8nConnected:!1,databaseConnected:!1}}}}const Rt=()=>{const{isActive:a,error:t,toggleAutomation:s,updateConfig:r,triggerN8nWorkflow:l,syncWithN8n:c,startProspectionCampaign:i,isLoading:n,initializeConfig:m}=$t(),{handleError:f,handleSuccess:b}=W(),[C,h]=o.useState(null),[j,E]=o.useState([]),[v,g]=o.useState(null),[y,S]=o.useState(!0),[T,q]=o.useState(!1),[P,x]=o.useState({status:"disconnected",color:"red",label:"Vérification...",n8nConnected:!1,databaseConnected:!1}),w=o.useCallback(async()=>{const R=await ee.fetchAutomationConfig();R&&g(R)},[]),d=o.useCallback(async()=>{if(!v)return;const R=await ee.fetchAutomationStats(v);R&&h(R),S(!1)},[v]),_=o.useCallback(async()=>{if(!v)return;const R=await ee.fetchRecentActivity(v);E(R)},[v]),D=o.useCallback(async()=>{const R=await ee.checkSystemHealth(v,a,t);x(R)},[v,a,t]),I=o.useCallback(async R=>{if(!v){f("Configuration non initialisée","Impossible de mettre à jour une configuration non chargée");return}try{S(!0);const z={...v,...R};await ee.updateConfig(z),g(z),b("Configuration mise à jour avec succès")}catch(z){f("Erreur lors de la mise à jour de la configuration",z instanceof Error?z.message:"Erreur inconnue")}finally{S(!1)}},[v,f,b]),O=o.useCallback(async()=>{try{S(!0),await l("update-scores"),await d(),b("Scores mis à jour avec succès")}catch(R){f("Erreur lors de la mise à jour des scores",R instanceof Error?R.message:"Erreur inconnue")}finally{S(!1)}},[l,d,f,b]);o.useEffect(()=>{m()},[m]),o.useEffect(()=>{w()},[w]),o.useEffect(()=>{v&&(d(),_())},[v,d,_]),o.useEffect(()=>{D();const R=setInterval(D,3e4);return()=>clearInterval(R)},[D]);const V=o.useCallback(async()=>{q(!0);try{await c()}finally{q(!1)}},[c]);return{stats:C,recentActivity:j,config:v,isLoading:y||n,isSyncing:T,systemHealth:P,isActive:a,error:t,toggleAutomation:s,updateConfig:I,updateScores:O,syncWithN8n:V,startProspectionCampaign:i,refreshStats:d,refreshActivity:_,refreshHealth:D}},Lt=({systemHealth:a})=>e.jsx("div",{className:"bg-gray-800/50 border border-gray-700/50 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full bg-${a.color}-400 animate-pulse`}),a.n8nConnected?e.jsx(yt,{className:"w-4 h-4 text-green-400"}):e.jsx(ft,{className:"w-4 h-4 text-red-400"}),e.jsxs("span",{className:"text-white font-medium",children:["Système: ",a.label]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-400",children:[e.jsxs("span",{children:["DB: ",a.databaseConnected?"✓":"✗"]}),e.jsxs("span",{children:["n8n: ",a.n8nConnected?"✓":"✗"]})]})]}),a.lastActivity&&e.jsxs("span",{className:"text-gray-400 text-sm",children:["Dernière activité: ",a.lastActivity.toLocaleTimeString()]})]})}),ye=a=>a>=1e6?`${(a/1e6).toFixed(1)}M`:a>=1e3?`${(a/1e3).toFixed(1)}K`:a.toString(),je=a=>`${(a*100).toFixed(1)}%`,Re={blue:"from-blue-600 to-blue-700 text-blue-100",green:"from-green-600 to-green-700 text-green-100",purple:"from-purple-600 to-purple-700 text-purple-100",orange:"from-orange-600 to-orange-700 text-orange-100",red:"from-red-600 to-red-700 text-red-100",indigo:"from-indigo-600 to-indigo-700 text-indigo-100"},Le={success:"text-green-400",warning:"text-yellow-400",error:"text-red-400",default:"text-gray-400"},It={success:"Succès",warning:"Attention",error:"Erreur"},Ot={success:"bg-green-900/30 text-green-400",warning:"bg-yellow-900/30 text-yellow-400",error:"bg-red-900/30 text-red-400"},Ht=[{value:"monday",label:"Lundi"},{value:"tuesday",label:"Mardi"},{value:"wednesday",label:"Mercredi"},{value:"thursday",label:"Jeudi"},{value:"friday",label:"Vendredi"},{value:"saturday",label:"Samedi"},{value:"sunday",label:"Dimanche"}],zt=a=>({prospect_added:"👤",email_sent:"📧",email_opened:"👁️",email_replied:"💬",sequence_started:"🚀"})[a]||"📋",Ft=a=>{const t=new Date,s=new Date(a),r=Math.floor((t.getTime()-s.getTime())/(1e3*60*60));return r<1?"Il y a moins d'1h":r<24?`Il y a ${r}h`:`Il y a ${Math.floor(r/24)}j`},Ut=a=>Re[a]||Re.blue,Wt=a=>Le[a]||Le.default,Vt=a=>It[a]||a,Bt=a=>Ot[a]||"bg-gray-900/30 text-gray-400",Gt=({stats:a,config:t})=>{const s=[{title:"Prospects ajoutés",value:ye(a.prospectsAdded),trend:a.prospectsAddedTrend,icon:ve,color:"blue"},{title:"E-mails envoyés",value:ye(a.emailsSent),trend:a.emailsSentTrend,icon:re,color:"green"},{title:"Taux d'ouverture",value:je(a.openRate),trend:a.openRateTrend,icon:he,color:"purple"},{title:"Taux de réponse",value:je(a.responseRate),trend:a.responseRateTrend,icon:Xe,color:"orange"},{title:"Taux de conversion",value:je(a.conversionRate),trend:0,icon:ae,color:"red"},{title:"Séquences actives",value:ye(a.activeSequences),trend:0,icon:Te,color:"indigo"}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map((r,l)=>{const c=r.icon,i=r.trend>0,n=i?Ce:bt;return e.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700/50 rounded-xl p-6 hover:bg-gray-800/70 transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-lg bg-gradient-to-r ${Ut(r.color)}`,children:e.jsx(c,{className:"w-6 h-6"})}),r.trend!==0&&e.jsxs("div",{className:`flex items-center space-x-1 text-sm ${i?"text-green-400":"text-red-400"}`,children:[e.jsx(n,{className:"w-4 h-4"}),e.jsxs("span",{children:[Math.abs(r.trend),"%"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white mb-1",children:r.value}),e.jsx("p",{className:"text-gray-400 text-sm",children:r.title})]})]},l)})})},Jt=({activities:a,onUpdateScores:t,onStartCampaign:s})=>{const[r,l]=Pe.useState(!1),[c,i]=Pe.useState(!1),n=async()=>{l(!0);try{await t()}finally{l(!1)}},m=async()=>{i(!0);try{await s()}finally{i(!1)}};return e.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Activité récente"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:n,disabled:r,className:"flex items-center space-x-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-800 text-white rounded-lg transition-colors text-sm",children:[e.jsx(xe,{className:`w-4 h-4 ${r?"animate-spin":""}`}),e.jsx("span",{children:r?"Mise à jour...":"Actualiser"})]}),e.jsxs("button",{onClick:m,disabled:c,className:"flex items-center space-x-2 px-3 py-2 bg-green-600 hover:bg-green-700 disabled:bg-green-800 text-white rounded-lg transition-colors text-sm",children:[e.jsx(ke,{className:`w-4 h-4 ${c?"animate-pulse":""}`}),e.jsx("span",{children:c?"Démarrage...":"Campagne"})]})]})]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:a.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Te,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400",children:"Aucune activité récente"})]}):a.map(f=>{const b=zt(f.type);return e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-gray-900/30 rounded-lg",children:[e.jsx("div",{className:`p-2 rounded-lg bg-gray-700 ${Wt(f.status)}`,children:e.jsx("span",{className:"text-sm",children:b})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white text-sm font-medium",children:f.description}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:Ft(f.timestamp)})]}),e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${Bt(f.status)}`,children:Vt(f.status)})]},f.id)})})]})},Qt=({config:a,onUpdateConfig:t})=>{const[s,r]=o.useState(a),[l,c]=o.useState(!1),[i,n]=o.useState(!1);o.useEffect(()=>{r(a),n(!1)},[a]);const m=(h,j)=>{r(E=>({...E,[h]:j})),n(!0)},f=(h,j,E)=>{r(v=>{const g=v[h];return typeof g=="object"&&g!==null?{...v,[h]:{...g,[j]:E}}:{...v,[h]:{[j]:E}}}),n(!0)},b=async()=>{c(!0);try{await t(s),n(!1)}finally{c(!1)}},C=(h,j)=>{const E=j?[...s.workingDays,h]:s.workingDays.filter(v=>v!==h);m("workingDays",E)};return e.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ye,{className:"w-6 h-6 text-blue-400"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Configuration"})]}),i&&e.jsxs("button",{onClick:b,disabled:l,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-green-800 text-white rounded-lg transition-colors",children:[e.jsx(He,{className:`w-4 h-4 ${l?"animate-pulse":""}`}),e.jsx("span",{children:l?"Sauvegarde...":"Sauvegarder"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-lg font-medium text-white flex items-center space-x-2",children:[e.jsx(ae,{className:"w-5 h-5 text-blue-400"}),e.jsx("span",{children:"Limites et délais"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Limite quotidienne d'e-mails"}),e.jsx("input",{type:"number",value:s.dailyLimit,onChange:h=>m("dailyLimit",parseInt(h.target.value)||0),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"1",max:"1000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Délai de suivi (heures)"}),e.jsx("input",{type:"number",value:s.followUpDelay,onChange:h=>m("followUpDelay",parseInt(h.target.value)||0),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"1",max:"168"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-lg font-medium text-white flex items-center space-x-2",children:[e.jsx(Te,{className:"w-5 h-5 text-blue-400"}),e.jsx("span",{children:"Heures de travail"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Heure de début"}),e.jsx("input",{type:"time",value:s.workingHours.start,onChange:h=>f("workingHours","start",h.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Heure de fin"}),e.jsx("input",{type:"time",value:s.workingHours.end,onChange:h=>f("workingHours","end",h.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-lg font-medium text-white flex items-center space-x-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-blue-400"}),e.jsx("span",{children:"Jours de travail"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:Ht.map(h=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.workingDays.includes(h.value),onChange:j=>C(h.value,j.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-300",children:h.label})]},h.value))})]})]})]})};function Zt(){const{stats:a,recentActivity:t,config:s,isLoading:r,isSyncing:l,systemHealth:c,isActive:i,error:n,toggleAutomation:m,updateConfig:f,updateScores:b,syncWithN8n:C,startProspectionCampaign:h}=Rt();return r||!s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(xe,{className:"w-8 h-8 animate-spin text-blue-400"})}):e.jsxs("div",{className:"space-y-8",children:[n&&e.jsx("div",{className:"bg-red-900/20 border border-red-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ee,{className:"w-5 h-5 text-red-400"}),e.jsx("span",{className:"text-red-300",children:n})]})}),e.jsx(Lt,{systemHealth:c}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-r from-purple-600 to-blue-600 rounded-xl",children:e.jsx(Ue,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-white",children:"Automation Dashboard"}),e.jsx("p",{className:"text-gray-400",children:"Pilotez votre prospection automatisée avec n8n"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:`flex items-center space-x-2 px-4 py-2 rounded-lg ${i?"bg-green-900/20 border border-green-500/30":"bg-red-900/20 border border-red-500/30"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${i?"bg-green-400":"bg-red-400"}`}),e.jsx("span",{className:`text-sm font-medium ${i?"text-green-300":"text-red-300"}`,children:i?"Actif":"Inactif"})]}),e.jsxs("button",{onClick:C,disabled:l,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-800 text-white rounded-lg transition-colors",children:[e.jsx(xe,{className:`w-4 h-4 ${l?"animate-spin":""}`}),e.jsx("span",{children:l?"Sync...":"Sync n8n"})]}),e.jsxs("button",{onClick:m,disabled:r,className:`flex items-center space-x-2 px-6 py-3 rounded-xl font-medium transition-all duration-200 disabled:opacity-50 ${i?"bg-red-600 hover:bg-red-700 text-white":"bg-green-600 hover:bg-green-700 text-white"}`,children:[i?e.jsx(xt,{className:"w-5 h-5"}):e.jsx(ke,{className:"w-5 h-5"}),e.jsx("span",{children:i?"Suspendre":"Activer"})]})]})]}),a&&e.jsx(Gt,{stats:a,config:s}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsx(Jt,{activities:t,onUpdateScores:b,onStartCampaign:h}),e.jsx(Qt,{config:s,onUpdateConfig:f})]})]})}const Kt=()=>{var S,T,q,P;const{saveProspect:a}=K(),{handleSuccess:t,handleError:s}=W(),[r,l]=o.useState(!1),[c,i]=o.useState(!0),[n,m]=o.useState({limit:25,quickFilters:{industry:"",location:"",companySize:""}}),[f,b]=o.useState([]),[C,h]=o.useState(!1),[j,E]=o.useState({industries:[],locations:[],companySizes:[]});o.useEffect(()=>{v()},[]);const v=async()=>{i(!0);try{await De.initialize(),E({industries:[{value:"music",label:"Musique"},{value:"media",label:"Médias"},{value:"advertising",label:"Publicité"},{value:"luxury",label:"Luxe"},{value:"sports",label:"Sports"}],locations:[{value:"france",label:"France"},{value:"europe",label:"Europe"},{value:"international",label:"International"}],companySizes:[{value:"startup",label:"1-10 employés"},{value:"small",label:"11-50 employés"},{value:"medium",label:"51-200 employés"},{value:"large",label:"200+ employés"}]})}catch(x){console.error("Erreur lors du chargement des options:",x),s("Erreur de configuration","Impossible de charger les options de filtrage")}finally{i(!1)}},g=async()=>{l(!0);try{const w=(await De.fetchProspects(n)).map(d=>({email:d.email,first_name:d.first_name,last_name:d.last_name,company_name:d.company,position:d.position,source:"api_import",status:"new",lead_score:d.score||50,company_industry:d.industry,company_size:d.company_size,company_location:d.company}));b(w),h(!0),t(`${w.length} prospects trouvés`)}catch(x){const w=x instanceof Error?x.message:"Erreur inconnue";s("Erreur lors de la recherche",w),console.error("Détails de l'erreur:",x)}finally{l(!1)}},y=async x=>{l(!0);try{for(const w of x){const d={email:w.email,first_name:w.first_name,last_name:w.last_name,company_name:w.company_name,position:w.position,source:w.source||"api_import",status:w.status||"new",lead_score:w.lead_score||50,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};await a(d)}t(`${x.length} prospects importés avec succès`),h(!1),b([])}catch(w){const d=w instanceof Error?w.message:"Erreur inconnue";s("Erreur lors de l'importation",d)}finally{l(!1)}};return c?e.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-2xl border border-gray-700/50 p-6",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-purple-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-gray-400",children:"Chargement des options..."})]})})}):e.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-2xl border border-gray-700/50 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg",children:e.jsx(_e,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Prospection Automatisée"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Importez des prospects via APIs publiques"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:v,className:"p-2 text-gray-400 hover:text-white transition-colors",title:"Actualiser les options",children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx("span",{className:"text-xs text-green-400 bg-green-900/20 px-2 py-1 rounded-full",children:"APIs Dynamiques"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Industrie"}),e.jsxs("select",{value:((S=n.quickFilters)==null?void 0:S.industry)||"",onChange:x=>m({...n,quickFilters:{...n.quickFilters,industry:x.target.value||void 0}}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white",children:[e.jsx("option",{value:"",children:"Toutes les industries"}),j.industries.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Localisation"}),e.jsxs("select",{value:((T=n.quickFilters)==null?void 0:T.location)||"",onChange:x=>m({...n,quickFilters:{...n.quickFilters,location:x.target.value||void 0}}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white",children:[e.jsx("option",{value:"",children:"Toutes les localisations"}),j.locations.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Taille d'entreprise"}),e.jsxs("select",{value:((q=n.quickFilters)==null?void 0:q.companySize)||"",onChange:x=>m({...n,quickFilters:{...n.quickFilters,companySize:x.target.value||void 0}}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white",children:[e.jsx("option",{value:"",children:"Toutes les tailles"}),j.companySizes.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Limite"}),e.jsxs("select",{value:n.limit,onChange:x=>m({...n,limit:parseInt(x.target.value)}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white",children:[e.jsx("option",{value:10,children:"10 prospects"}),e.jsx("option",{value:25,children:"25 prospects"}),e.jsx("option",{value:50,children:"50 prospects"}),e.jsx("option",{value:100,children:"100 prospects"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Mots-clés (optionnel)"}),e.jsx("input",{type:"text",value:((P=n.keywords)==null?void 0:P.join(", "))||"",onChange:x=>m({...n,keywords:x.target.value?x.target.value.split(",").map(w=>w.trim()):void 0}),placeholder:"Ex: marketing, design, startup...",className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Nom d'entreprise (optionnel)"}),e.jsx("input",{type:"text",value:n.companyName||"",onChange:x=>m({...n,companyName:x.target.value||void 0}),placeholder:"Ex: Google, Microsoft...",className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-400"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Recherche en langage naturel (optionnel)"}),e.jsx("textarea",{value:n.naturalLanguageQuery||"",onChange:x=>m({...n,naturalLanguageQuery:x.target.value||void 0}),placeholder:"Ex: Startups françaises dans le domaine de la tech avec moins de 50 employés...",rows:3,className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-400 resize-none"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:g,disabled:r,className:"flex items-center space-x-2 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 text-white px-6 py-3 rounded-lg font-medium transition-all",children:[r?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Ve,{className:"w-4 h-4"}),e.jsx("span",{children:r?"Recherche...":"Rechercher des Prospects"})]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Recherche dynamique via APIs configurables"})]}),C&&e.jsx(Xt,{prospects:f,onImport:y,onCancel:()=>h(!1),isLoading:r})]})},Xt=({prospects:a,onImport:t,onCancel:s,isLoading:r})=>{const[l,c]=o.useState(a),i=n=>{c(m=>m.includes(n)?m.filter(f=>f!==n):[...m,n])};return e.jsxs("div",{className:"mt-6 border-t border-gray-700 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-white",children:["Prévisualisation (",a.length," prospects trouvés)"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>c(a),className:"text-sm text-blue-400 hover:text-blue-300",children:"Tout sélectionner"}),e.jsx("button",{onClick:()=>c([]),className:"text-sm text-gray-400 hover:text-gray-300",children:"Tout désélectionner"})]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2 mb-4",children:a.map((n,m)=>e.jsx("div",{className:`p-3 rounded-lg border cursor-pointer transition-all ${l.includes(n)?"bg-blue-900/20 border-blue-500/50":"bg-gray-700/30 border-gray-600 hover:border-gray-500"}`,onClick:()=>i(n),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-white",children:[n.first_name," ",n.last_name]}),e.jsxs("div",{className:"text-sm text-gray-400",children:[n.position," chez ",n.company_name]}),e.jsx("div",{className:"text-xs text-gray-500",children:n.email}),(n.company_industry||n.company_size||n.company_location)&&e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[n.company_industry&&e.jsx("span",{className:"text-xs bg-purple-900/20 text-purple-400 px-2 py-1 rounded-full",children:n.company_industry}),n.company_size&&e.jsx("span",{className:"text-xs bg-blue-900/20 text-blue-400 px-2 py-1 rounded-full",children:n.company_size}),n.company_location&&e.jsx("span",{className:"text-xs bg-green-900/20 text-green-400 px-2 py-1 rounded-full",children:n.company_location})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-xs bg-green-900/20 text-green-400 px-2 py-1 rounded-full",children:["Score: ",n.lead_score]}),e.jsx("input",{type:"checkbox",checked:l.includes(n),onChange:()=>i(n),className:"w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded"})]})]})},`${n.email}-${m}`))}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:[l.length," prospects sélectionnés"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 text-gray-400 hover:text-white transition-colors",children:"Annuler"}),e.jsxs("button",{onClick:()=>t(l),disabled:l.length===0||r,className:"flex items-center space-x-2 bg-green-600 hover:bg-green-700 disabled:opacity-50 text-white px-6 py-2 rounded-lg font-medium transition-all",children:[r?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(it,{className:"w-4 h-4"}),e.jsxs("span",{children:["Importer ",l.length," prospects"]})]})]})]})]})},ms=()=>{const{loadProspects:a,prospects:t}=K(),[s,r]=o.useState("list"),[l,c]=o.useState(null),[i,n]=o.useState(null),[m,f]=o.useState(null),[b,C]=o.useState(!1);o.useEffect(()=>{a()},[a]);const h=d=>{c(d),r("details")},j=d=>{n(d),r("form")},E=()=>{n(null),r("form")},v=()=>{n(null),r("list")},g=()=>{c(null),r("list")},y=()=>{l&&(n(l),r("form"))},S=()=>{f(null),r("template-form")},T=d=>{f(d),r("template-form")},q=()=>{f(null),r("templates")},P=d=>{r(d),C(!1)},x=[{id:"list",label:"Prospects",icon:ve},{id:"import",label:"Import Auto",icon:_e},{id:"campaign",label:"Campagnes",icon:re},{id:"stats",label:"Statistiques",icon:Fe},{id:"templates",label:"Templates",icon:Z},{id:"automation",label:"Automation",icon:Ue}],w=t.filter(d=>d.next_follow_up?new Date(d.next_follow_up)<=new Date:!1);return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-black to-gray-900 pt-20",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 sm:py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl",children:e.jsx(ae,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent",children:"Prospection Hub"}),e.jsx("p",{className:"text-gray-400 text-sm sm:text-base mt-1",children:"Gérez vos prospects avec intelligence et efficacité"})]})]}),w.length>0&&e.jsxs("div",{className:"hidden md:flex items-center space-x-2 bg-orange-900/20 border border-orange-500/30 rounded-lg px-4 py-2",children:[e.jsx(rt,{className:"w-5 h-5 text-orange-400"}),e.jsxs("span",{className:"text-orange-300 text-sm",children:[w.length," suivi",w.length>1?"s":""," en attente"]})]}),e.jsx("button",{onClick:()=>C(!b),className:"md:hidden p-3 rounded-xl bg-gray-800 text-gray-300 hover:text-white hover:bg-gray-700 transition-all duration-200",children:b?e.jsx(se,{className:"w-6 h-6"}):e.jsx(et,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600/20 to-blue-800/20 border border-blue-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-300 text-sm font-medium",children:"Total Prospects"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:t.length})]}),e.jsx(ve,{className:"w-8 h-8 text-blue-400"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-green-600/20 to-green-800/20 border border-green-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-300 text-sm font-medium",children:"Qualifiés"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:t.filter(d=>d.status==="qualified").length})]}),e.jsx(Ce,{className:"w-8 h-8 text-green-400"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-purple-600/20 to-purple-800/20 border border-purple-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-300 text-sm font-medium",children:"Gagnés"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:t.filter(d=>d.status==="closed_won").length})]}),e.jsx(ae,{className:"w-8 h-8 text-purple-400"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-orange-600/20 to-orange-800/20 border border-orange-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-300 text-sm font-medium",children:"Score Moyen"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:t.length>0?Math.round(t.reduce((d,_)=>d+(_.lead_score||0),0)/t.length):0})]}),e.jsx(_e,{className:"w-8 h-8 text-orange-400"})]})})]})]}),(s==="list"||s==="campaign"||s==="stats"||s==="templates"||s==="automation"||s==="import")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:flex space-x-2 mb-8 bg-gray-800/50 backdrop-blur-sm p-2 rounded-2xl border border-gray-700/50",children:x.map(d=>{const _=d.icon,D=s===d.id;return e.jsxs("button",{onClick:()=>P(d.id),className:`flex items-center space-x-3 px-6 py-3 rounded-xl transition-all duration-200 font-medium ${D?"bg-blue-600 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-gray-700/50"}`,children:[e.jsx(_,{className:"w-5 h-5"}),e.jsx("span",{children:d.label}),d.id==="automation"&&e.jsx("span",{className:"bg-green-500 text-xs px-2 py-1 rounded-full",children:"NEW"})]},d.id)})}),b&&e.jsx("div",{className:"md:hidden mb-6 bg-gray-800/95 backdrop-blur-sm rounded-2xl border border-gray-700/50 overflow-hidden",children:e.jsx("div",{className:"p-2 space-y-1",children:x.map(d=>{const _=d.icon,D=s===d.id;return e.jsxs("button",{onClick:()=>P(d.id),className:`w-full flex items-center justify-between px-4 py-4 rounded-xl text-left transition-all duration-200 ${D?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-700/50"}`,children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(_,{className:"w-6 h-6"}),e.jsx("span",{className:"font-medium",children:d.label})]}),d.id==="automation"&&e.jsx("span",{className:"bg-green-500 text-xs px-2 py-1 rounded-full",children:"NEW"})]},d.id)})})})]}),e.jsx("div",{className:"bg-gray-800/30 backdrop-blur-sm rounded-2xl border border-gray-700/50 overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[s==="list"&&e.jsx("div",{children:e.jsx(jt,{onViewDetails:h,onEditProspect:j,onAddProspect:E})}),s==="import"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Prospection Automatisée"}),e.jsx("p",{className:"text-gray-400",children:"Importez automatiquement des prospects qualifiés via des APIs publiques gratuites"})]}),e.jsx(Kt,{})]}),s==="form"&&e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:i?"Modifier le prospect":"Ajouter un prospect"}),e.jsx("p",{className:"text-gray-400",children:i?"Mettez à jour les informations du prospect":"Créez un nouveau prospect dans votre pipeline"})]}),e.jsx(vt,{prospectId:i||void 0,onClose:v})]}),s==="details"&&l&&e.jsx("div",{className:"p-6",children:e.jsx(St,{prospectId:l,onClose:g,onEdit:y})}),s==="campaign"&&e.jsx("div",{className:"p-6",children:e.jsx(Pt,{})}),s==="stats"&&e.jsx("div",{className:"p-6",children:e.jsx(Dt,{})}),s==="templates"&&e.jsx("div",{className:"p-6",children:e.jsx($e,{activeTab:"list",onTabChange:d=>{d==="form"&&r("template-form")},onEditTemplate:T,onAddTemplate:S})}),s==="template-form"&&e.jsx("div",{className:"p-6",children:e.jsx($e,{activeTab:"form",editingTemplateId:m,onCloseForm:q})}),s==="automation"&&e.jsx("div",{className:"p-6",children:e.jsx(Zt,{})})]})})]})})};export{ms as default};
//# sourceMappingURL=ProspectionDashboard-dL8jucQG.js.map
