import{d as ne,b as ce,j as e,F as j,e as _,V as U,C as q,X as de,s as I}from"./index-DN8h3Y9b.js";import{r as i}from"./react-vendor-VkFUI6JC.js";import{C as O}from"./ConfirmDialog-BT3SwRyR.js";import{A as ue,D as me,P as xe}from"./DragDropReorder-Czt_8iWJ.js";import{P as z}from"./save-CY1Hemzt.js";import{m as S}from"./ui-vendor-jY-liuQK.js";import{U as pe}from"./user-CCxstMVk.js";import{T as ge}from"./trash-2-BwtB9nAO.js";import{U as he}from"./upload-t_bHCpCi.js";import{C as be}from"./check-circle-DsTvJVik.js";const De=()=>{const{projects:c,createProject:V,updateProject:L,deleteProject:$,updateProjectOrder:G,fetchProjects:Y,isLoading:B}=ne(),{handleError:m,handleSuccess:p}=ce(),[y,u]=i.useState("list"),[x,D]=i.useState(null),[t,d]=i.useState({}),[v,M]=i.useState(null),[J,N]=i.useState(!1),[T,F]=i.useState(null),[W,w]=i.useState(!1),[R,P]=i.useState(null),[g,X]=i.useState("all"),[E,C]=i.useState(!1),h=i.useMemo(()=>{const r=c.length,s=c.filter(o=>o.type==="music").length,a=c.filter(o=>o.type==="video").length,l=new Date().getFullYear(),n=c.filter(o=>o.year>=l-1).length;return{total:r,musicProjects:s,videoProjects:a,recentProjects:n}},[c]),k=i.useMemo(()=>g==="all"?c:c.filter(r=>r.type===g),[c,g]),Z=r=>{if(r.target.files&&r.target.files[0]){const s=r.target.files[0];if(s.size>5*1024*1024){m("L'image ne doit pas dépasser 5MB");return}if(!["image/jpeg","image/png","image/webp"].includes(s.type)){m("Le fichier doit être une image (JPG, PNG ou WebP)");return}M(s);const a=new FileReader;a.onloadend=()=>{P(a.result)},a.readAsDataURL(s)}},H=r=>r?/^(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})$/.test(r):!0,K=async r=>{const s=r.name.split(".").pop(),l=`projects/${`${Math.random()}.${s}`}`,{error:n}=await I.storage.from("media").upload(l,r);if(n)throw n;const{data:o}=I.storage.from("media").getPublicUrl(l);return o.publicUrl},Q=async r=>{var s,a,l;r.preventDefault();try{if(!((s=t.title)!=null&&s.trim())||!((a=t.artist)!=null&&a.trim())||!((l=t.description)!=null&&l.trim()))throw new Error("Veuillez remplir tous les champs obligatoires");if(t.video_url&&!H(t.video_url))throw new Error("L'URL YouTube n'est pas valide");let n=t.image_url;v&&(n=await K(v));const o={...t,title:t.title.trim(),artist:t.artist.trim(),description:t.description.trim(),image_url:n||"",year:t.year||new Date().getFullYear(),type:t.type||"music"};x?(await L(x,o),p("Projet mis à jour avec succès")):(await V(o),p("Projet créé avec succès")),b(),u("list")}catch(n){m(n,"Erreur lors de la sauvegarde du projet")}},ee=r=>{D(r.id),d(r),P(null),u("form")},re=r=>{F(r),N(!0)},te=async()=>{if(T)try{await $(T),p("Projet supprimé avec succès")}catch(r){m(r,"Erreur lors de la suppression du projet")}finally{F(null),N(!1)}},b=()=>{d({}),D(null),M(null),P(null)},se=()=>{b(),u("form")},A=()=>{Object.keys(t).length>0||v?w(!0):(b(),u("list"))},ae=()=>{b(),u("list"),w(!1)},le=async r=>{try{for(let s=0;s<r.length;s++){const a=r[s],l=s+1;a.display_order!==l&&await G(a.id,l)}await Y(),C(!1),p("Ordre des projets mis à jour avec succès")}catch(s){m(s,"Erreur lors de la réorganisation des projets")}},ie=r=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden bg-gray-700 flex-shrink-0",children:r.image_url?e.jsx("img",{src:r.image_url,alt:r.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-r from-purple-600 to-blue-600 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold",children:r.title.charAt(0)})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-semibold",children:r.title}),e.jsxs("p",{className:"text-gray-400 text-sm",children:[r.artist," • ",r.year]}),e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs ${r.type==="music"?"bg-purple-500/20 text-purple-300":"bg-blue-500/20 text-blue-300"}`,children:r.type==="music"?"Musique":"Vidéo"})]})]}),oe=[{id:"list",label:"Liste des Projets",icon:j},{id:"form",label:x?"Modifier Projet":"Nouveau Projet",icon:z}];if(B)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-black to-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Chargement des projets..."})]})});const f=({title:r,value:s,icon:a,gradient:l})=>e.jsx("div",{className:`${l} border border-opacity-30 rounded-xl p-4`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium opacity-80",children:r}),e.jsx("p",{className:"text-2xl font-bold text-white",children:s})]}),e.jsx(a,{className:"w-8 h-8 opacity-80"})]})});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-black to-gray-900",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-900/20 via-blue-900/20 to-indigo-900/20 border-b border-gray-800",children:e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-r from-purple-600 to-blue-600 rounded-xl",children:e.jsx(j,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent",children:"Gestion des Projets"}),e.jsx("p",{className:"text-gray-400 text-sm sm:text-base mt-1",children:"Gérez votre portfolio de projets musicaux et vidéos"})]})]})}),e.jsx("div",{className:"flex space-x-1 bg-gray-800/30 backdrop-blur-sm rounded-xl p-1",children:oe.map(r=>{const s=r.icon;return e.jsxs("button",{onClick:()=>u(r.id),className:`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${y===r.id?"bg-gradient-to-r from-purple-600 to-blue-600 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-gray-700/50"}`,children:[e.jsx(s,{className:"w-4 h-4"}),e.jsx("span",{children:r.label})]},r.id)})})]})}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[y==="list"&&e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(f,{title:"Total Projets",value:h.total,icon:j,gradient:"bg-gradient-to-r from-purple-600/20 to-purple-800/20 border-purple-500/30 text-purple-300"}),e.jsx(f,{title:"Projets Musicaux",value:h.musicProjects,icon:_,gradient:"bg-gradient-to-r from-blue-600/20 to-blue-800/20 border-blue-500/30 text-blue-300"}),e.jsx(f,{title:"Projets Vidéo",value:h.videoProjects,icon:U,gradient:"bg-gradient-to-r from-green-600/20 to-green-800/20 border-green-500/30 text-green-300"}),e.jsx(f,{title:"Récents",value:h.recentProjects,icon:q,gradient:"bg-gradient-to-r from-orange-600/20 to-orange-800/20 border-orange-500/30 text-orange-300"})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("select",{value:g,onChange:r=>X(r.target.value),className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700/50 rounded-xl px-4 py-2 text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"Tous les types"}),e.jsx("option",{value:"music",children:"Musique"}),e.jsx("option",{value:"video",children:"Vidéo"})]}),e.jsxs("button",{onClick:()=>C(!0),className:"flex items-center space-x-2 px-4 py-2 rounded-xl bg-gray-700/50 text-gray-300 hover:bg-gray-700 transition-all duration-200",children:[e.jsx(ue,{className:"w-4 h-4"}),e.jsx("span",{children:"Réorganiser"})]})]}),e.jsxs("button",{onClick:se,className:"flex items-center space-x-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white px-6 py-2 rounded-xl hover:from-purple-700 hover:to-blue-700 transition-all duration-200 shadow-lg",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{children:"Nouveau Projet"})]})]}),E?e.jsx(me,{items:k,onReorder:le,renderItem:ie,getItemId:r=>r.id,title:"Réorganiser les projets",isOpen:E,onClose:()=>C(!1)}):e.jsx(e.Fragment,{children:k.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(j,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"Aucun projet trouvé"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Créez votre premier projet pour commencer"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:k.map(r=>e.jsxs(S.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700/50 rounded-2xl overflow-hidden hover:border-purple-500/30 transition-all duration-300 group",children:[e.jsxs("div",{className:"relative h-48 overflow-hidden",children:[e.jsx("img",{src:r.image_url,alt:r.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",onError:s=>{const a=s.target;a.src="https://placehold.co/600x400?text=Image+non+disponible"}}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs("span",{className:`inline-flex items-center space-x-1 px-3 py-1 rounded-full text-xs font-medium ${r.type==="music"?"bg-blue-500/20 text-blue-300 border border-blue-500/30":"bg-green-500/20 text-green-300 border border-green-500/30"}`,children:[r.type==="music"?e.jsx(_,{className:"w-3 h-3"}):e.jsx(U,{className:"w-3 h-3"}),e.jsx("span",{children:r.type==="music"?"Musique":"Vidéo"})]})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2 group-hover:text-purple-300 transition-colors",children:r.title}),e.jsxs("div",{className:"flex items-center space-x-2 text-gray-400 text-sm mb-3",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{children:r.artist}),e.jsx("span",{children:"•"}),e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{children:r.year})]}),e.jsx("p",{className:"text-gray-300 text-sm mb-4 line-clamp-2",children:r.description}),e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("button",{onClick:()=>ee(r),className:"p-2 text-purple-400 hover:text-purple-300 hover:bg-purple-500/10 rounded-lg transition-all duration-200",title:"Modifier",children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>re(r.id),className:"p-2 text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg transition-all duration-200",title:"Supprimer",children:e.jsx(ge,{className:"w-4 h-4"})})]})]})]},r.id))})})]}),y==="form"&&e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-800/50 to-gray-900/50 backdrop-blur-sm border border-gray-700/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:x?"Modifier le Projet":"Nouveau Projet"}),e.jsx("button",{onClick:A,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(de,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:Q,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Titre du projet *"}),e.jsx("input",{type:"text",value:t.title||"",onChange:r=>d({...t,title:r.target.value}),className:"w-full px-4 py-3 bg-gray-800/50 border border-gray-700/50 rounded-xl text-white placeholder-gray-400 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all",placeholder:"Nom du projet",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Artiste *"}),e.jsx("input",{type:"text",value:t.artist||"",onChange:r=>d({...t,artist:r.target.value}),className:"w-full px-4 py-3 bg-gray-800/50 border border-gray-700/50 rounded-xl text-white placeholder-gray-400 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all",placeholder:"Nom de l'artiste",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Description *"}),e.jsx("textarea",{value:t.description||"",onChange:r=>d({...t,description:r.target.value}),className:"w-full px-4 py-3 bg-gray-800/50 border border-gray-700/50 rounded-xl text-white placeholder-gray-400 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all",rows:4,placeholder:"Description du projet",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Année *"}),e.jsx("input",{type:"number",value:t.year||"",onChange:r=>d({...t,year:parseInt(r.target.value)||void 0}),className:"w-full px-4 py-3 bg-gray-800/50 border border-gray-700/50 rounded-xl text-white placeholder-gray-400 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all",placeholder:"2024",min:"1900",max:"2100",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Type *"}),e.jsxs("select",{value:t.type||"",onChange:r=>d({...t,type:r.target.value}),className:"w-full px-4 py-3 bg-gray-800/50 border border-gray-700/50 rounded-xl text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all",required:!0,children:[e.jsx("option",{value:"",children:"Sélectionner le type"}),e.jsx("option",{value:"music",children:"Musique"}),e.jsx("option",{value:"video",children:"Vidéo"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"URL YouTube (optionnel)"}),e.jsx("input",{type:"url",value:t.video_url||"",onChange:r=>d({...t,video_url:r.target.value}),className:"w-full px-4 py-3 bg-gray-800/50 border border-gray-700/50 rounded-xl text-white placeholder-gray-400 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all",placeholder:"https://www.youtube.com/watch?v=..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Image du projet"}),(R||t.image_url)&&e.jsx("div",{className:"mb-4",children:e.jsx("img",{src:R||t.image_url,alt:"Prévisualisation",className:"w-full h-48 object-cover rounded-xl border border-gray-700/50"})}),e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-700/50 border-dashed rounded-xl cursor-pointer bg-gray-800/30 hover:bg-gray-800/50 transition-all",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(he,{className:"w-8 h-8 mb-2 text-gray-400"}),e.jsxs("p",{className:"mb-2 text-sm text-gray-400",children:[e.jsx("span",{className:"font-semibold",children:"Cliquez pour télécharger"})," ou glissez-déposez"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG ou WebP (MAX. 5MB)"})]}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:Z})]})})]}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx("button",{type:"button",onClick:A,className:"flex-1 px-6 py-3 bg-gray-700/50 text-gray-300 rounded-xl hover:bg-gray-700 transition-all duration-200",children:"Annuler"}),e.jsxs("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl hover:from-purple-700 hover:to-blue-700 transition-all duration-200 shadow-lg flex items-center justify-center space-x-2",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{children:x?"Mettre à jour":"Créer le projet"})]})]})]})]})})]}),e.jsx(O,{isOpen:J,onClose:()=>N(!1),onConfirm:te,title:"Supprimer le projet",message:"Êtes-vous sûr de vouloir supprimer ce projet ? Cette action est irréversible.",confirmText:"Supprimer",cancelText:"Annuler",type:"danger"}),e.jsx(O,{isOpen:W,onClose:()=>w(!1),onConfirm:ae,title:"Fermer le formulaire",message:"Vous avez des modifications non enregistrées. Êtes-vous sûr de vouloir fermer le formulaire ?",confirmText:"Fermer",cancelText:"Continuer l'édition",type:"warning"})]})};export{De as default};
//# sourceMappingURL=ProjectsAdmin-CGxM5iYL.js.map
